!function(){function e(e,n){function u(n){return n.data.checkingPresence&&e.channels[n.userid]?void e.channels[n.userid].send({presenceDetected:!0}):n.data.presenceDetected&&e.peers[n.userid]?void(e.peers[n.userid].connected=!0):void("text"===n.data.type?en.receive(n.data,n.userid,n.extra):e.autoTranslateText?(n.original=n.data,e.Translator.TranslateText(n.data,function(t){n.data=t,e.onmessage(n)})):e.onmessage(n))}function M(n){return e.skipOnNewSession||(n.session||(n.session={}),n.extra||(n.extra={}),e.sessionid&&n.sessionid!=e.sessionid)?void 0:e.onNewSession?(n.join=function(t){if(!t)return e.join(n);for(var i in t)n.session[i]=t[i];var o=e.dontCaptureUserMedia;e.dontCaptureUserMedia=!1,e.captureUserMedia(function(){e.dontCaptureUserMedia=!0,e.join(n),e.dontCaptureUserMedia=o},t)},n.extra||(n.extra={}),e.onNewSession(n)):void e.join(n)}function O(n){for(var t=0;t<e.localStreamids.length;t++){var i=e.localStreamids[t];e.streams[i]&&e.streams[i].sockets.push(n)}}function E(n){function t(n){return H||W||o(e.waitUntilRemoteStreamStartsFlowing)||!e.waitUntilRemoteStreamStartsFlowing?l(n):(n.numberOfTimes||(n.numberOfTimes=0),n.numberOfTimes++,n.mediaElement.readyState>HTMLMediaElement.HAVE_CURRENT_DATA&&!n.mediaElement.paused&&n.mediaElement.currentTime>0?l(n):n.numberOfTimes<60?void setTimeout(function(){m("Waiting for incoming remote stream to be started flowing: "+n.numberOfTimes+" seconds."),t(n)},900):U.send({failedToReceiveRemoteVideo:!0,streamid:n.stream.streamid}))}function d(){if(e.fakeDataChannels&&!e.channels[n.userid]&&!e.session.data){var t={send:function(e){U.send({fakeData:e})},readyState:"open"};e.channels[n.userid]={channel:t,send:function(e){this.channel.send(e)}},_.onopen(t)}}function l(t){var i=t.mediaElement,o=t.session,s=t.stream;s.onended=function(){a.mediaElement&&!a.mediaElement.parentNode&&document.getElementById(s.streamid)&&(a.mediaElement=document.getElementById(s.streamid)),g(a,e)};var a={mediaElement:i,stream:s,streamid:s.streamid,session:o||e.session,blobURL:W?"":i.mozSrcObject?URL.createObjectURL(s):i.src,type:"remote",extra:n.extra,userid:n.userid,isVideo:W?!!o.video:!!s.isVideo,isAudio:W?!!o.audio&&!o.video:!!s.isAudio,isScreen:!!s.isScreen,isInitiator:!!n.isInitiator,rtcMultiConnection:e,socket:U};if(e.streams[s.streamid]=e._getStream(a),e.onstream(a),!r(t.preMuted)&&(t.preMuted.audio||t.preMuted.video)){var d=b({},a);d.session=b(d.session,t.preMuted),d.isAudio=!!d.session.audio&&!d.session.video,d.isVideo=!!d.session.video,d.isScreen=!1,e.onmute(d)}m("on:add:stream",a),x(),e.onspeaking&&D({stream:s,streamedObject:a,connection:e})}function C(t){n.channel=t,e.channels[n.userid]={channel:n.channel,send:function(n){e.send(n,this.channel)}},e.onopen({extra:n.extra,userid:n.userid,channel:t});for(var o in e.fileQueue)e.send(e.fileQueue[o],t);i(e.session)&&x(),e.partOfScreen&&e.partOfScreen.sharing&&e.peers[n.userid].sharePartOfScreen(e.partOfScreen)}function R(){U.userid!=n.userid&&(U.userid=n.userid,K[n.socketIndex]=U,e.numberOfConnectedUsers++,e.peers[n.userid]={socket:U,peer:N,userid:n.userid,extra:n.extra,userinfo:n.userinfo,addStream:function(n){e.addStream(n,this.socket)},removeStream:function(n){return e.streams[n]?(this.peer.connection.removeStream(e.streams[n].stream),void this.renegotiate()):f("No such stream exists. Stream-id:",n)},renegotiate:function(n,t){e.renegotiate(n,t)},changeBandwidth:function(e){if(!e)throw"You MUST pass bandwidth object.";if(s(e))throw"Pass object for bandwidth instead of string; e.g. {audio:10, video:20}";this.peer.bandwidth=e,this.socket.send({changeBandwidth:!0,bandwidth:e})},sendCustomMessage:function(e){this.socket.send({customMessage:!0,message:e})},onCustomMessage:function(e){m('Received "private" message from',this.userid,s(e)?e:p(e))},drop:function(n){for(var t in e.streams)-1==e._skip.indexOf(t)&&(t=e.streams[t],t.userid==e.userid&&"local"==t.type&&(this.peer.connection.removeStream(t.stream),g(t,e)),"remote"==t.type&&t.userid==this.userid&&g(t,e));!n&&this.socket.send({drop:!0})},hold:function(n){return"answer"==N.prevCreateType?void this.socket.send({unhold:!0,holdMLine:n||"both",takeAction:!0}):(this.socket.send({hold:!0,holdMLine:n||"both"}),this.peer.hold=!0,void this.fireHoldUnHoldEvents({kind:n,isHold:!0,userid:e.userid,remoteUser:this.userid}))},unhold:function(n){return"answer"==N.prevCreateType?void this.socket.send({unhold:!0,holdMLine:n||"both",takeAction:!0}):(this.socket.send({unhold:!0,holdMLine:n||"both"}),this.peer.hold=!1,void this.fireHoldUnHoldEvents({kind:n,isHold:!1,userid:e.userid,remoteUser:this.userid}))},fireHoldUnHoldEvents:function(n){var t=n.isHold,i=n.kind,o=n.remoteUser||n.userid;for(var s in e.streams)-1==e._skip.indexOf(s)&&(s=e.streams[s],s.userid==o&&(t&&e.onhold(b({kind:i},s)),t||e.onunhold(b({kind:i},s))))},redial:function(){for(var n in e.streams)-1==e._skip.indexOf(n)&&(n=e.streams[n],n.userid==this.userid&&"remote"==n.type&&g(n,e));m("ReDialing..."),U.send({recreatePeer:!0}),N=new A,N.create("offer",_)},sharePartOfScreen:function(n){function t(){return i.stopPartOfScreenSharing?(i.stopPartOfScreenSharing=!1,void(e.onpartofscreenstopped&&e.onpartofscreenstopped())):i.pausePartOfScreenSharing?(e.onpartofscreenpaused&&e.onpartofscreenpaused(),setTimeout(t,n.interval||200)):void T({element:n.element,connection:e,callback:function(s){if(!e.channels[i.userid])throw"No such data channel exists.";s!=o&&(o=s,e.channels[i.userid].send({screenshot:s,isPartOfScreen:!0})),!n.once&&setTimeout(t,n.interval||200)}})}var i=this,o="";t()},getConnectionStats:function(n,t){function i(){an.prototype.getConnectionStats=window.getConnectionStats,N.connection&&N.connection.getConnectionStats(n,t)}if(!n)throw"callback is mandatory.";window.getConnectionStats?i():y(e.resources.getConnectionStats,i)},takeSnapshot:function(n){w({userid:this.userid,connection:e,callback:n})}})}function x(){if(e.isInitiator&&h(Z)&&h(Z)<=e.maxParticipantsAllowed&&(e.session.oneway||e.session.broadcast||nn.send({sessionid:e.sessionid,newParticipant:n.userid||U.channel,userData:{userid:n.userid||U.channel,extra:n.extra}})),"chrome"==n.userinfo.browser&&!n.renegotiatedOnce)for(var t in e.renegotiatedSessions)n.renegotiatedOnce=!0,e.renegotiatedSessions[t]&&e.renegotiatedSessions[t].stream&&e.peers[n.userid].renegotiate(e.renegotiatedSessions[t].stream,e.renegotiatedSessions[t].session)}function M(t){if(!tn&&t.userid!=e.userid){if(t.sdp){n.userid=t.userid,n.extra=t.extra||{},n.renegotiate=t.renegotiate,n.streaminfo=t.streaminfo,n.isInitiator=t.isInitiator,n.userinfo=t.userinfo;var i=JSON.parse(t.sdp);"offer"==i.type&&(_.preferSCTP=!!t.preferSCTP,e.fakeDataChannels=!!t.fakeDataChannels),d(),E(i,t.labels)}if(t.candidate&&N&&N.addIceCandidate(JSON.parse(t.candidate)),t.streamid&&($.streamids||($.streamids={}),$.streamids[t.streamid]||($.streamids[t.streamid]=t.streamid,e.onstreamid(t))),t.mute||t.unmute)if(t.promptMuteUnmute){if(!e.privileges.canMuteRemoteStream)return void e.onstatechange({userid:t.userid,extra:t.extra,name:"mute-request-denied",reason:t.userid+' tried to mute your stream; however "privileges.canMuteRemoteStream" is "false".'});e.streams[t.streamid]&&(t.mute&&!e.streams[t.streamid].muted&&e.streams[t.streamid].mute(t.session),t.unmute&&e.streams[t.streamid].muted&&e.streams[t.streamid].unmute(t.session))}else{var o={};e.streams[t.streamid]&&(o=e.streams[t.streamid]);var s=t.session,r=b({},o);r.session=s,r.isAudio=!!r.session.audio&&!r.session.video,r.isVideo=!!r.session.video,r.isScreen=!!r.session.screen,t.mute&&e.onmute(r||t),t.unmute&&e.onunmute(r||t)}if(t.isVolumeChanged&&(m("Volume of stream: "+t.streamid+" has changed to: "+t.volume),e.streams[t.streamid])){var a=e.streams[t.streamid].mediaElement;a&&(a.volume=t.volume)}if(t.stopped&&e.streams[t.streamid]&&g(e.streams[t.streamid],e),t.promptStreamStop){if(!e.privileges.canStopRemoteStream)return void e.onstatechange({userid:t.userid,extra:t.extra,name:"stop-request-denied",reason:t.userid+' tried to stop your stream; however "privileges.canStopRemoteStream" is "false".'});f("Remote stream has been manually stopped!"),e.streams[t.streamid]&&e.streams[t.streamid].stop()}if(t.left){if(V){var u=t.userid;for(var l in e.streams)l=e.streams[l],l.userid==u&&(e.stopMediaStream(l),g(l,e))}if(N&&N.connection&&("closed"!=N.connection.signalingState&&-1==N.connection.iceConnectionState.search(/disconnected|failed/gi)&&N.connection.close(),N.connection=null),Z[t.userid]&&delete Z[t.userid],t.closeEntireSession)return e.onSessionClosed(t),void e.leave();e.remove(t.userid),S({userid:t.userid,extra:t.extra||{},entireSessionClosed:!!t.closeEntireSession},e)}if(t.playRoleOfBroadcaster&&(t.extra&&(e.extra=b(e.extra,t.extra)),t.participants&&(Z=t.participants,Z[e.userid]&&delete Z[e.userid],K[0]&&K[0].userid==t.userid&&(delete K[0],K=c(K)),X[t.userid]&&delete X[t.userid]),setTimeout(e.playRoleOfInitiator,2e3)),t.changeBandwidth){if(!e.peers[t.userid])throw"No such peer exists.";e.peers[t.userid].peer.bandwidth=t.bandwidth,e.peers[t.userid].renegotiate()}if(t.customMessage){if(!e.peers[t.userid])throw"No such peer exists.";if(t.message.ejected){if(e.sessionDescriptions[e.sessionid].userid!=t.userid)throw"only initiator can eject a user.";e.leave(),e.onSessionClosed({userid:t.userid,extra:t.extra||n.extra,isEjected:!0})}else e.peers[t.userid].onCustomMessage(t.message)}if(t.drop){if(!e.peers[t.userid])throw"No such peer exists.";e.peers[t.userid].drop(!0),e.peers[t.userid].renegotiate(),e.ondrop(t.userid)}if(t.hold||t.unhold){if(!e.peers[t.userid])throw"No such peer exists.";if(t.takeAction)return void e.peers[t.userid][t.hold?"hold":"unhold"](t.holdMLine);e.peers[t.userid].peer.hold=!!t.hold,e.peers[t.userid].peer.holdMLine=t.holdMLine,U.send({isRenegotiate:!0}),e.peers[t.userid].fireHoldUnHoldEvents({kind:t.holdMLine,isHold:!!t.hold,userid:t.userid})}t.isRenegotiate&&e.peers[t.userid].renegotiate(null,e.peers[t.userid].peer.session),t.fakeData&&_.onmessage(t.fakeData),t.recreatePeer&&(N=new A),t.failedToReceiveRemoteVideo&&(m("Remote peer hasn't received stream: "+t.streamid+". Renegotiating..."),e.peers[t.userid]&&e.peers[t.userid].renegotiate()),t.redial&&e.peers[t.userid]&&("disconnected"!=e.peers[t.userid].peer.connection.iceConnectionState&&(n.redialing=!1),"disconnected"!=e.peers[t.userid].peer.connection.iceConnectionState||n.redialing||(n.redialing=!0,f("Peer connection is closed.",p(e.peers[t.userid].peer.connection),"ReDialing.."),e.peers[t.userid].redial()))}}function E(t,o){function s(){N.recreateAnswer(t,r,function(n,t){L({sdp:n,socket:U,streaminfo:t}),e.detachStreams=[]})}if("answer"==t.type)return N.setRemoteDescription(t),void R();if(!n.renegotiate&&"offer"==t.type)return _.offerDescription=t,_.session=e.session,N||(N=new A),N.create("answer",_),void R();var r=n.renegotiate;if(P(o,N.connection),r.oneway||i(r))s(),delete n.renegotiate;else{if(n.capturing)return;n.capturing=!0,e.captureUserMedia(function(t){n.capturing=!1,N.addStream(t),e.renegotiatedSessions[JSON.stringify(n.renegotiate)]={session:n.renegotiate,stream:t},delete n.renegotiate,s()},n.renegotiate)}}var I={channel:n.channel,onmessage:M,onopen:function(t){t&&(U=t),F&&!N&&(_.session=e.session,N||(N=new A),N.create("offer",_)),n.socketIndex=U.index=K.length,X[I.channel]=U,K[n.socketIndex]=U,O(U),U.__push||(U.__push=U.send,U.send=function(n){n.userid=n.userid||e.userid,n.extra=n.extra||e.extra||{},U.__push(n)})}};I.callback=function(e){U=e,I.onopen()};var U=e.openSignalingChannel(I);U&&I.onopen(U);var N,F=n.isofferer,_={onopen:C,onicecandidate:function(n){if(!e.candidates)throw"ICE candidates are mandatory.";if(!e.iceProtocols)throw"At least one must be true; UDP or TCP.";var t=e.candidates,i=t.stun,s=t.turn;if(o(t.reflexive)||(i=t.reflexive),o(t.relay)||(s=t.relay),(t.host||!n.candidate.match(/a=candidate.*typ host/g))&&!(!s&&n.candidate.match(/a=candidate.*typ relay/g)||!i&&n.candidate.match(/a=candidate.*typ srflx/g))){var r=e.iceProtocols;(r.udp||!n.candidate.match(/a=candidate.* udp/g))&&(r.tcp||!n.candidate.match(/a=candidate.* tcp/g))&&(window.selfNPObject||(window.selfNPObject=n),U&&U.send({candidate:JSON.stringify({candidate:n.candidate,sdpMid:n.sdpMid,sdpMLineIndex:n.sdpMLineIndex})}))}},onmessage:function(t){if(t){var i=a(t);if(-1!=i.indexOf('"userid":'))i=JSON.parse(i),u(i);else if(t instanceof ArrayBuffer||t instanceof DataView){if(!e.enableFileSharing)throw'It seems that receiving data is either "Blob" or "File" but file sharing is disabled.';if(!$.fileBufferReader){var o=this;return void k(e,function(e){$.fileBufferReader=e,o.onmessage(t)})}var s=$.fileBufferReader;return void s.convertToObject(t,function(t){return t.maxChunks||t.readyForNextChunk?t.readyForNextChunk?void s.getNextChunk(t.uuid,function(e){$.send(e)}):void s.addChunk(t,function(e){$.send(e)}):void e.onmessage({data:t,userid:n.userid,extra:n.extra})})}}},onaddstream:function(o,s){function r(){setTimeout(function(){u.muted=!1,l({mediaElement:u,session:s,stream:o,preMuted:a})},3e3),u.removeEventListener("play",r)}if(s=s||n.renegotiate||e.session,!i(s)){s.screen&&(s.audio||s.video)&&(n.gotAudioOrVideo?(s.audio=!1,s.video=!1):(n.gotAudioOrVideo=!0,s.screen=!1));var a={};if(n.streaminfo){var d=n.streaminfo.split("----"),c=JSON.parse(d[d.length-1]);j||(o.streamid=c.streamid,o.isScreen=!!c.isScreen,o.isVideo=!!c.isVideo,o.isAudio=!!c.isAudio,a=c.preMuted),d.pop(),n.streaminfo=d.join("----")}var u=v(o,b({remote:!0},s));return e.setDefaultEventsForMediaElement&&e.setDefaultEventsForMediaElement(u,o.streamid),W||o.getVideoTracks().length?void t({mediaElement:u,session:s,stream:o,preMuted:a}):u.addEventListener("play",r,!1)}},onremovestream:function(n){n&&n.streamid?(n=e.streams[n.streamid],n&&(m("on:stream:ended via on:remove:stream",n),g(n,e))):m("on:remove:stream",n)},onclose:function(t){t.extra=n.extra,t.userid=n.userid,e.onclose(t),e.channels[t.userid]&&delete e.channels[t.userid]},onerror:function(t){t.extra=n.extra,t.userid=n.userid,e.onerror(t)},oniceconnectionstatechange:function(t){m("oniceconnectionstatechange",p(t)),N.connection&&"connected"==N.connection.iceConnectionState&&"complete"==N.connection.iceGatheringState&&"stable"==N.connection.signalingState&&1==e.numberOfConnectedUsers&&e.onconnected({userid:n.userid,extra:n.extra,peer:e.peers[n.userid],targetuser:n.userinfo}),!e.isInitiator&&N.connection&&"connected"==N.connection.iceConnectionState&&"complete"==N.connection.iceGatheringState&&"stable"==N.connection.signalingState&&1==e.numberOfConnectedUsers&&e.onstatechange({userid:n.userid,extra:n.extra,name:"connected-with-initiator",reason:"ICE connection state seems connected; gathering state is completed; and signaling state is stable."}),e.peers[n.userid]&&e.peers[n.userid].oniceconnectionstatechange&&e.peers[n.userid].oniceconnectionstatechange(t),e.peers[n.userid]&&"failed"==e.peers[n.userid].peer.connection.iceConnectionState&&e.onfailed({userid:n.userid,extra:n.extra,peer:e.peers[n.userid],targetuser:n.userinfo}),e.peers[n.userid]&&"disconnected"==e.peers[n.userid].peer.connection.iceConnectionState&&(!N.connection.renegotiate&&e.ondisconnected({userid:n.userid,extra:n.extra,peer:e.peers[n.userid],targetuser:n.userinfo}),N.connection.renegotiate=!1),e.autoReDialOnFailure&&e.peers[n.userid]&&("disconnected"!=e.peers[n.userid].peer.connection.iceConnectionState&&(n.redialing=!1),"disconnected"!=e.peers[n.userid].peer.connection.iceConnectionState||n.redialing||(n.redialing=!0,f("Peer connection is closed.",p(e.peers[n.userid].peer.connection),"ReDialing.."),e.peers[n.userid].socket.send({redial:!0}),e.streams.remove({remote:!0,userid:n.userid})))},onsignalingstatechange:function(e){m("onsignalingstatechange",p(e))},attachStreams:e.dontAttachStream?[]:e.attachStreams,iceServers:e.iceServers,rtcConfiguration:e.rtcConfiguration,bandwidth:e.bandwidth,sdpConstraints:e.sdpConstraints,optionalArgument:e.optionalArgument,disableDtlsSrtp:e.disableDtlsSrtp,dataChannelDict:e.dataChannelDict,preferSCTP:e.preferSCTP,onSessionDescription:function(e,n){L({sdp:e,socket:U,streaminfo:n})},trickleIce:e.trickleIce,processSdp:e.processSdp,sendStreamId:function(e){U&&U.send({streamid:e.streamid,isScreen:!!e.isScreen,isAudio:!!e.isAudio,isVideo:!!e.isVideo})},rtcMultiConnection:e};e.playRoleOfInitiator=function(){e.dontCaptureUserMedia=!0,e.open(),K=c(K),e.dontCaptureUserMedia=!1},e.askToShareParticipants=function(){nn&&nn.send({askToShareParticipants:!0})},e.shareParticipants=function(n){var t={joinUsers:Z,userid:e.userid,extra:e.extra};n&&(n.dontShareWith&&(t.dontShareWith=n.dontShareWith),n.shareWith&&(t.shareWith=n.shareWith)),nn.send(t)}}function P(n,t){if(n)for(var i=0;i<n.length;i++){var o=n[i];e.streams[o]&&t.removeStream(e.streams[o].stream)}}function L(n){n.socket.send({sdp:JSON.stringify({sdp:n.sdp.sdp,type:n.sdp.type}),renegotiate:n.renegotiate?n.renegotiate:!1,streaminfo:n.streaminfo||"",labels:n.labels||[],preferSCTP:!!e.preferSCTP,fakeDataChannels:!!e.fakeDataChannels,isInitiator:!!e.isInitiator,userinfo:{browser:V?"firefox":"chrome"}})}function F(n){var t=n.newParticipant;if(t&&!Z[t]&&t!=e.userid){var i=e.token();E({channel:i,extra:n.userData?n.userData.extra:n.extra,userid:n.userData?n.userData.userid:n.userid}),nn.send({participant:!0,targetUser:t,channel:i})}}function _(){e.numberOfConnectedUsers--;var n={left:!0,extra:e.extra||{},userid:e.userid,sessionid:e.sessionid};e.isInitiator&&(e.autoCloseEntireSession?n.closeEntireSession=!0:K[0]&&K[0].send({playRoleOfBroadcaster:!0,userid:e.userid,extra:e.extra,participants:Z})),K.forEach(function(e,t){e.send(n),X[e.channel]&&delete X[e.channel],delete K[t]}),K=c(K),e.refresh(),N.forEach(function(e){e.disconnect()}),N=[]}function B(){$.signalingReady||($.signalingReady=!0,setTimeout(n,1e3),e.isInitiator||nn&&nn.send({searchingForRooms:!0}))}function q(n){for(var t in n)Z[n[t]]||F({sessionid:e.sessionid,newParticipant:n[t],userid:e.userid,extra:e.extra})}function z(){return e.openSignalingChannel({onmessage:function(n){if(!tn&&n.userid!=e.userid){if(n.sessionid&&n.userid&&(e.sessionDescriptions[n.sessionid]||(e.numberOfSessions++,e.sessionDescriptions[n.sessionid]=n,e.isAcceptNewSession&&(e.dontOverrideSession||(e.session=n.session),M(n)))),n.newParticipant&&!e.isAcceptNewSession&&$.broadcasterid===n.userid&&n.newParticipant!=e.userid&&F(n),h(Z)<e.maxParticipantsAllowed&&n.targetUser==e.userid&&n.participant){if(e.peers[n.userid]&&!e.peers[n.userid].peer)return delete Z[n.userid],delete e.peers[n.userid],e.isAcceptNewSession=!0,Y(n);Z[n.userid]||Y(n)}if(n.acceptedRequestOf==e.userid&&e.onstatechange({userid:n.userid,extra:n.extra,name:"request-accepted",reason:n.userid+" accepted your participation request."}),n.rejectedRequestOf==e.userid&&e.onstatechange({userid:n.userid,extra:n.extra,name:"request-rejected",reason:n.userid+" rejected your participation request."}),n.customMessage)if(n.message.drop){e.ondrop(n.userid),e.attachStreams=[];for(var t in e.streams)-1==e._skip.indexOf(t)&&(t=e.streams[t],"local"==t.type?(e.detachStreams.push(t.streamid),g(t,e)):g(t,e));n.message.renegotiate&&e.renegotiate()}else e.onCustomMessage&&e.onCustomMessage(n.message);if(e.isInitiator&&n.searchingForRooms&&nn&&nn.send({sessionDescription:e.sessionDescription,responseFor:n.userid}),n.sessionDescription&&n.responseFor==e.userid){var i=n.sessionDescription;e.sessionDescriptions[i.sessionid]||(e.numberOfSessions++,e.sessionDescriptions[i.sessionid]=i)}e.isInitiator&&n.askToShareParticipants&&nn&&e.shareParticipants({shareWith:n.userid}),n.shareWith==e.userid&&n.dontShareWith!=e.userid&&n.joinUsers&&q(n.joinUsers),!n.shareWith&&n.joinUsers&&(n.dontShareWith?e.userid!=n.dontShareWith&&q(n.joinUsers):q(n.joinUsers)),n.messageFor==e.userid&&n.presenceState&&("checking"==n.presenceState&&(nn.send({messageFor:n.userid,presenceState:"available",_config:n._config}),m("participant asked for availability")),"available"==n.presenceState&&($.presenceState="available",e.onstatechange({userid:"browser",extra:{},name:"room-available",reason:"Initiator is available and room is active."}),J(n._config))),n.donotJoin&&n.messageFor==e.userid&&m(n.userid,"is not joining your room."),n.isDisconnectSockets&&(m("Disconnecting your sockets because initiator also disconnected his sockets."),e.disconnect())}},callback:function(e){e&&this.onopen(e)},onopen:function(n){n&&(nn=n),B&&B(),$.defaultSocket=nn,nn.__push||(nn.__push=nn.send,nn.send=function(n){n.userid=n.userid||e.userid,n.extra=n.extra||e.extra||{},nn.__push(n)})}})}function G(){var n=0;256!=e.maxParticipantsAllowed&&(n=e.maxParticipantsAllowed),"one-way"==e.direction&&(e.session.oneway=!0),"one-to-one"==e.direction&&(e.maxParticipantsAllowed=1),"one-to-many"==e.direction&&(e.session.broadcast=!0),"many-to-many"==e.direction&&(e.maxParticipantsAllowed&&1!=e.maxParticipantsAllowed||(e.maxParticipantsAllowed=256)),n&&1!=e.maxParticipantsAllowed&&(e.maxParticipantsAllowed=n)}function J(n){if(!$.donotJoin||$.donotJoin!=n.sessionid){e.dontOverrideSession||(e.session=n.session||{}),$.broadcasterid=n.userid,n.sessionid&&(e.sessionid=n.sessionid),e.isAcceptNewSession=!1;var i=t();E({channel:i,extra:n.extra||{},userid:n.userid});var o={};if(e.attachStreams.length){var s=e.attachStreams[e.attachStreams.length-1];s.getAudioTracks&&s.getAudioTracks().length&&(o.audio=!0),s.getVideoTracks().length&&(o.video=!0)}m(r(o)?"Seems data-only connection.":p(o)),e.onstatechange({userid:n.userid,extra:{},name:"connecting-with-initiator",reason:"Checking presence of the initiator; and the room."}),nn.send({participant:!0,channel:i,targetUser:n.userid,session:e.session,offers:{audio:!!o.audio,video:!!o.video}}),e.skipOnNewSession=!1,C(e)}}function Y(n){if($.requestsFrom||($.requestsFrom={}),!$.requestsFrom[n.userid]){var t={userid:n.userid,extra:n.extra,channel:n.channel||n.userid,session:n.session||e.session};if(n.offers){m(n.offers.audio&&n.offers.video?"target user has both audio/video streams.":n.offers.audio&&!n.offers.video?"target user has only audio stream.":!n.offers.audio&&n.offers.video?"target user has only video stream.":"target user has no stream; it seems one-way streaming or data-only connection.");var i=e.sdpConstraints.mandatory;o(i.OfferToReceiveAudio)&&(e.sdpConstraints.mandatory.OfferToReceiveAudio=!!n.offers.audio),o(i.OfferToReceiveVideo)&&(e.sdpConstraints.mandatory.OfferToReceiveVideo=!!n.offers.video),m("target user's SDP has?",p(e.sdpConstraints.mandatory))}$.requestsFrom[n.userid]=t,e.onRequest&&e.isInitiator?e.onRequest(t):Q(t)}}function Q(n){return $.captureUserMediaOnDemand?($.captureUserMediaOnDemand=!1,void e.captureUserMedia(function(){Q(n),C(e)})):(m("accepting request from",n.userid),Z[n.userid]=n.userid,void E({isofferer:!0,userid:n.userid,channel:n.channel,extra:n.extra||{},session:n.session||e.session}))}var X={},K=[],$=this,Z={};!$.fileBufferReader&&e.session.data&&e.enableFileSharing&&k(e,function(e){$.fileBufferReader=e});var en=new I(e);e.remove=function(n){$.requestsFrom&&$.requestsFrom[n]&&delete $.requestsFrom[n],e.peers[n]&&(e.peers[n].peer&&e.peers[n].peer.connection&&("closed"!=e.peers[n].peer.connection.signalingState&&e.peers[n].peer.connection.close(),e.peers[n].peer.connection=null),delete e.peers[n]),Z[n]&&delete Z[n];for(var t in e.streams)t=e.streams[t],t.userid==n&&(g(t,e),delete e.streams[t]);X[n]&&delete X[n]},e.refresh=function(){e.isInitiator&&e.socket&&e.socket.remove&&e.socket.remove(),Z={};for(var n=0;n<e.attachStreams.length;n++)e.stopMediaStream(e.attachStreams[n]);cn={streams:[],mutex:!1,queueRequests:[]},$.isOwnerLeaving=!0,e.isInitiator=!1,e.isAcceptNewSession=!0,e.attachMediaStreams=[],e.sessionDescription=null,e.sessionDescriptions={},e.localStreamids=[],e.preRecordedMedias={},e.snapshots={},e.numberOfConnectedUsers=0,e.numberOfSessions=0,e.attachStreams=[],e.detachStreams=[],e.fileQueue={},e.channels={},e.renegotiatedSessions={};for(var t in e.peers)t!=e.userid&&delete e.peers[t];for(var i in e.streams)-1==e._skip.indexOf(i)&&(g(e.streams[i],e),delete e.streams[i]);X={},K=[],Z={}},e.reject=function(n){s(n)||(n=n.userid),nn.send({rejectedRequestOf:n}),e.remove(n)},$.leaveHandler=function(n){return e.leaveOnPageUnload?o(n.keyCode)?_():void(116==n.keyCode&&_()):void 0},U("beforeunload",$.leaveHandler),U("keyup",$.leaveHandler),$.onLineOffLineHandler=function(){navigator.onLine?$.isOffLine&&($.isOffLine=!navigator.onLine):$.isOffLine=!0},U("load",$.onLineOffLineHandler),U("online",$.onLineOffLineHandler),U("offline",$.onLineOffLineHandler);var nn=z();$.defaultSocket=nn,nn&&B&&setTimeout(B,2e3),e.session.screen&&R(),e.getExternalIceServers&&x(function(n){e.iceServers=e.iceServers.concat(n)}),0==e.log&&e.skipLogs(),e.onlog&&(m=f=l=function(){var n={},t=0;Array.prototype.slice.call(arguments).forEach(function(e){n[t++]=p(e)}),p=function(e){return e},e.onlog(n)}),this.initSession=function(n){function t(){nn&&h(Z)<e.maxParticipantsAllowed&&!$.isOwnerLeaving&&nn.send(e.sessionDescription),e.transmitRoomOnce||$.isOwnerLeaving||setTimeout(t,e.interval||3e3)}$.isOwnerLeaving=!1,G(),Z={},$.isOwnerLeaving=!1,o(n.transmitRoomOnce)||(e.transmitRoomOnce=n.transmitRoomOnce),n.dontTransmit||t()},this.joinSession=function(n){function t(){nn.send({messageFor:n.userid,presenceState:$.presenceState,_config:{userid:n.userid,extra:n.extra||{},sessionid:n.sessionid,session:n.session||!1}})}function i(){"checking"==$.presenceState&&(f("Unable to reach initiator. Trying again..."),t(),setTimeout(function(){"checking"==$.presenceState&&(e.onstatechange({userid:n.userid,extra:n.extra||{},name:"room-not-available",reason:"Initiator seems absent. Waiting for someone to open the room."}),e.isAcceptNewSession=!0,setTimeout(i,2e3))},2e3))}return nn?(n=n||{},Z={},$.presenceState="checking",e.onstatechange({userid:n.userid,extra:n.extra||{},name:"detecting-room-presence",reason:"Checking presence of the room."}),t(),void setTimeout(i,3e3)):setTimeout(function(){f("Default-Socket is not yet initialized."),$.joinSession(n)},1e3)},e.donotJoin=function(n){$.donotJoin=n;var t=e.sessionDescriptions[n];t&&(nn.send({donotJoin:!0,messageFor:t.userid,sessionid:n}),Z={},e.isAcceptNewSession=!0,e.sessionid=null)},this.send=function(n,t){if(n instanceof ArrayBuffer||n instanceof DataView||(n=d({extra:e.extra,userid:e.userid,data:n})),t)return void("open"==t.readyState&&t.send(n));for(var i in e.channels){var o=e.channels[i].channel;"open"==o.readyState&&o.send(n)}},this.leave=function(){_()},this.addStream=function(n){function t(t){var o=t.socket;if(!o)return void f(t,"doesn't has socket.");if(O(o),!t||!t.peer)throw"No peer to renegotiate.";var s=t.peer;n.stream&&(s.attachStreams||(s.attachStreams=[]),s.attachStreams.push(n.stream)),P(e.detachStreams,s.connection),n.stream&&(i.audio||i.video||i.screen)&&s.addStream(n.stream),s.recreateOffer(i,function(n,t){L({sdp:n,socket:o,renegotiate:i,labels:e.detachStreams,streaminfo:t}),e.detachStreams=[]})}var i=n.renegotiate;if(e.renegotiatedSessions[JSON.stringify(n.renegotiate)]||(e.renegotiatedSessions[JSON.stringify(n.renegotiate)]={session:n.renegotiate,stream:n.stream}),n.socket)n.socket.userid!=e.userid&&t(e.peers[n.socket.userid]);else for(var o in e.peers)o!=e.userid&&t(e.peers[o])},e.request=function(n,t){e.captureUserMedia(function(){E({channel:e.userid,extra:t||{},userid:n}),nn.send({participant:!0,targetUser:n})})},e.accept=function(n){arguments.length>1&&s(arguments[0])&&(n={},arguments[0]&&(n.userid=arguments[0]),arguments[1]&&(n.extra=arguments[1]),arguments[2]&&(n.channel=arguments[2])),e.captureUserMedia(function(){Q(n)})};var tn=!1;this.disconnect=function(){if(this.isOwnerLeaving=!0,!e.keepStreamsOpened){for(var n in e.localStreams)e.localStreams[n].stop();e.localStreams={},cn={streams:[],mutex:!1,queueRequests:[]}}e.isInitiator&&nn.send({isDisconnectSockets:!0}),e.refresh(),$.defaultSocket=nn=null,tn=!0,e.ondisconnected({userid:e.userid,extra:e.extra,peer:e.peers[e.userid],isSocketsDisconnected:!0}),e.close(),window.removeEventListener("beforeunload",$.leaveHandler),window.removeEventListener("keyup",$.leaveHandler),delete this,m("Disconnected your sockets, peers, streams and everything except RTCMultiConnection object.")}}function n(e){if(!e)throw"MediaStream is mandatory.";if(e.getVideoTracks&&!e.getVideoTracks().length)return e;var n=new AudioContext,t=n.createMediaStreamSource(e),i=n.createMediaStreamDestination();return t.connect(i),N.push(t),i.stream}function t(){if(window.crypto&&crypto.getRandomValues&&-1==navigator.userAgent.indexOf("Safari")){for(var e=window.crypto.getRandomValues(new Uint32Array(3)),n="",t=0,i=e.length;i>t;t++)n+=e[t].toString(36);return n}return(Math.random()*(new Date).getTime()).toString(36).replace(/\./g,"")}function i(e){return!e.audio&&!e.video&&!e.screen&&e.data}function o(e){return void 0===e}function s(e){return"string"==typeof e}function r(e){var n=0;for(var t in e)n++;return 0==n}function a(e){var n="";try{n=String.fromCharCode.apply(null,new Uint16Array(e))}catch(t){}return n}function d(e){s(e)||(e=JSON.stringify(e));for(var n=new ArrayBuffer(2*e.length),t=new Uint16Array(n),i=0,o=e.length;o>i;i++)t[i]=e.charCodeAt(i);return n}function c(e){for(var n=[],t=e.length,i=0;t>i;i++)e[i]&&e[i]!==!0&&n.push(e[i]);return n}function u(e,n){for(var t in e)n(e[t],t)}function m(){Y.log(arguments)}function l(){Y.error(arguments)}function f(){Y.warn(arguments)}function p(e){return JSON.stringify(e,function(e,n){return n&&n.sdp?(m(n.sdp.type,"	",n.sdp.sdp),""):n},"	")}function h(e){var n=0;for(var t in e)t&&n++;return n}function v(e,n){var t=document.createElement(e.isAudio?"audio":"video");if(t.id=e.streamid,W){var i=document.body||document.documentElement;return i.insertBefore(t,i.firstChild),setTimeout(function(){sn.attachMediaStream(t,e)},1e3),sn.attachMediaStream(t,e)}return t[V?"mozSrcObject":"src"]=V?e:(window.URL||window.webkitURL).createObjectURL(e),t.controls=!0,t.autoplay=!!n.remote,t.muted=n.remote?!1:!0,V&&t.addEventListener("ended",function(){e.onended()},!1),t.play(),t}function g(e,n){(!e.mediaElement||e.mediaElement.parentNode)&&($[e.streamid]||($[e.streamid]=e,n.onstreamended(e)))}function S(e,n){Z[e.userid]||(Z[e.userid]=e,n.onleave(e))}function w(e){function n(n){var o=document.createElement("canvas");o.width=n.clientWidth||n.videoWidth,o.height=n.clientHeight||n.videoHeight;var s=o.getContext("2d");s.drawImage(n,0,0,o.width,o.height),i.snapshots[t]=o.toDataURL("image/jpeg",.5),e.callback&&e.callback(i.snapshots[t])}var t=e.userid,i=e.connection;if(e.mediaElement)return n(e.mediaElement);for(var o in i.streams)o=i.streams[o],o.userid==t&&o.stream&&o.stream.getVideoTracks&&o.stream.getVideoTracks().length&&n(o.mediaElement)}function C(e){e.onMediaCaptured&&(e.onMediaCaptured(),delete e.onMediaCaptured)}function b(e,n){if(e||(e={}),!n)return e;for(var t in n)e[t]=n[t];return e}function y(e,n){var t=document.createElement("script");t.src=e,t.onload=function(){m("loaded resource:",e),n&&n()},document.documentElement.appendChild(t)}function T(e){var n=e.connection,t=e.element;if(!window.html2canvas)return y(n.resources.html2canvas,function(){T(e)});if(s(t)&&(t=document.querySelector(t),t||(t=document.getElementById(t))),!t)throw"HTML DOM Element is not accessible!";html2canvas(t,{onrendered:function(n){e.callback(n.toDataURL())}})}function k(e,n){function t(e){return e.userid=e.extra.userid,e}if(!window.FileBufferReader)return void y(e.resources.FileBufferReader,function(){k(e,n)});var i=new FileBufferReader;i.onProgress=function(n){e.onFileProgress(t(n),n.uuid)},i.onBegin=function(n){e.onFileStart(t(n))},i.onEnd=function(n){e.onFileEnd(t(n))},n(i)}function R(e){if(DetectRTC.screen.extensionid==tn&&!X){if(!e)return R(!0);X=!0;var n=document.createElement("iframe");n.onload=function(){n.isLoaded=!0,m("Screen Capturing frame is loaded.")},n.src="https://www.webrtc-experiment.com/getSourceId/",n.style.display="none",(document.body||document.documentElement).appendChild(n),Q={postMessage:function(){return n.isLoaded?void n.contentWindow.postMessage({captureSourceId:!0},"*"):void setTimeout(Q.postMessage,100)
}}}}function x(e,n){if(!K){if(!n)return x(e,!0);K=!0;var t=document.createElement("iframe");t.onload=function(){function n(t){t.data&&t.data.iceServers&&(e(t.data.iceServers),window.removeEventListener("message",n))}t.isLoaded=!0,U("message",n),t.contentWindow.postMessage("get-ice-servers","*")},t.src="https://cdn.webrtc-experiment.com/getIceServers/",t.style.display="none",(document.body||document.documentElement).appendChild(t)}}function M(e){var n=e.stream,t=e.root,i=e.session||{},o=e.enabled;if(i.audio||i.video||(i=s(i)?{audio:!0,video:!0}:b(i,{audio:!0,video:!0})),i.type){if("remote"==i.type&&"remote"!=t.type)return;if("local"==i.type&&"local"!=t.type)return}if(m(o?"Muting":"UnMuting","session",p(i)),"local"==t.type&&i.audio&&n.getAudioTracks){var r=n.getAudioTracks()[0];r&&(r.enabled=!o)}if("local"==t.type&&(i.video||i.screen)&&n.getVideoTracks){var a=n.getVideoTracks()[0];a&&(a.enabled=!o)}if(t.sockets.forEach(function(e){"local"==t.type&&e.send({streamid:t.streamid,mute:!!o,unmute:!o,session:i}),"remote"==t.type&&e.send({promptMuteUnmute:!0,streamid:t.streamid,mute:!!o,unmute:!o,session:i})}),"remote"!=t.type){var d=b({},t);d.session=i,d.isAudio=!!d.session.audio&&!d.session.video,d.isVideo=!!d.session.video,d.isScreen=!!d.session.screen,o&&(n.preMuted={audio:n.getAudioTracks().length&&!n.getAudioTracks()[0].enabled,video:n.getVideoTracks().length&&!n.getVideoTracks()[0].enabled},t.rtcMultiConnection.onmute(d)),o||(n.preMuted={},t.rtcMultiConnection.onunmute(d))}}function D(e){if(!window.hark)return void y(e.connection.resources.hark,function(){D(e)});var n=e.connection,t=e.streamedObject,i=e.stream,o={},s=hark(i,o);s.on("speaking",function(){n.onspeaking&&n.onspeaking(t)}),s.on("stopped_speaking",function(){n.onsilence&&n.onsilence(t)}),s.on("volume_change",function(e,i){n.onvolumechange&&n.onvolumechange(b({volume:e,threshold:i},t))})}function O(e){function n(n,o,s){s||(s=t()),i.localStreams[s]=n;var r=e.video;r&&(r[V?"mozSrcObject":"src"]=V?n:(window.URL||window.webkitURL).createObjectURL(n),r.play()),e.onsuccess(n,o,w,s),cn.streams[w]={stream:n,streamid:s},cn.mutex=!1,cn.queueRequests.length&&O(cn.queueRequests.shift())}if(W)return sn.getUserMedia?sn.getUserMedia(e.constraints||{audio:!0,video:!0},e.onsuccess,e.onerror):void setTimeout(function(){O(e)},1e3);if(cn.mutex===!0)return void cn.queueRequests.push(e);cn.mutex=!0;var i=e.connection,o=e.mediaConstraints||{},s="boolean"==typeof o.video?o.video:o.video||o,a="boolean"==typeof o.audio?o.audio:o.audio||dn,d=navigator,u=e.constraints||{audio:dn,video:dn};u.video&&u.video.mozMediaSource&&(s={}),1==u.video&&(u.video=dn),1==u.audio&&(u.audio=dn),"boolean"==typeof a&&u.audio&&(u.audio=a),"boolean"==typeof s&&u.video&&(u.video=s);var h=a.mandatory;r(h)||(u.audio.mandatory=b(u.audio.mandatory,h));var v=s.mandatory;if(v){var g={};if(v.minWidth&&(g.minWidth=v.minWidth),v.minHeight&&(g.minHeight=v.minHeight),v.maxWidth&&(g.maxWidth=v.maxWidth),v.maxHeight&&(g.maxHeight=v.maxHeight),v.minAspectRatio&&(g.minAspectRatio=v.minAspectRatio),v.maxFrameRate&&(g.maxFrameRate=v.maxFrameRate),v.minFrameRate&&(g.minFrameRate=v.minFrameRate),g.minWidth&&g.minHeight){var S=["1920:1080","1280:720","960:720","640:360","640:480","320:240","320:180"];(-1==S.indexOf(g.minWidth+":"+g.minHeight)||-1==S.indexOf(g.maxWidth+":"+g.maxHeight))&&l('The min/max width/height constraints you passed "seems" NOT supported.',p(g)),(g.minWidth>g.maxWidth||g.minHeight>g.maxHeight)&&l("Minimum value must not exceed maximum value.",p(g)),g.minWidth<1280||g.minHeight<720||f("Enjoy HD video! min/"+g.minWidth+":"+g.minHeight+", max/"+g.maxWidth+":"+g.maxHeight)}u.video.mandatory=b(u.video.mandatory,g)}v&&(u.video.mandatory=b(u.video.mandatory,v)),s.optional&&s.optional instanceof Array&&s.optional.length&&(u.video.optional=u.video.optional?u.video.optional.concat(s.optional):s.optional),a.optional&&a.optional instanceof Array&&a.optional.length&&(u.audio.optional=u.audio.optional?u.audio.optional.concat(a.optional):a.optional),u.video.mandatory&&!r(u.video.mandatory)&&i._mediaSources.video&&(u.video.optional.forEach(function(e,n){e.sourceId==i._mediaSources.video&&delete u.video.optional[n]}),u.video.optional=c(u.video.optional),u.video.optional.push({sourceId:i._mediaSources.video})),u.audio.mandatory&&!r(u.audio.mandatory)&&i._mediaSources.audio&&(u.audio.optional.forEach(function(e,n){e.sourceId==i._mediaSources.audio&&delete u.audio.optional[n]}),u.audio.optional=c(u.audio.optional),u.audio.optional.push({sourceId:i._mediaSources.audio})),u.video&&!u.video.mozMediaSource&&u.video.optional&&u.video.mandatory&&!u.video.optional.length&&r(u.video.mandatory)&&(u.video=!0),H&&(u={audio:!!u.audio,video:!!u.video}),m("invoked getUserMedia with constraints:",p(u));var w=JSON.stringify(u);cn.streams[w]?n(cn.streams[w].stream,!0,cn.streams[w].streamid):(d.getMedia=d.webkitGetUserMedia||d.mozGetUserMedia,d.getMedia(u,n,function(n){e.onerror(n,u)}))}function E(e){var n,t={OfferToReceiveAudio:!!e.OfferToReceiveAudio,OfferToReceiveVideo:!!e.OfferToReceiveVideo};return n={mandatory:t,optional:[{VoiceActivityDetection:!1}]},navigator.mozGetUserMedia&&J>34&&(n={OfferToReceiveAudio:!!e.OfferToReceiveAudio,OfferToReceiveVideo:!!e.OfferToReceiveVideo}),n}function A(){return{create:function(e,n){b(this,n);var t=this;return this.type=e,this.init(),this.attachMediaStreams(),V&&this.session.data?(this.session.data&&"offer"==e&&this.createDataChannel(),this.getLocalDescription(e),this.session.data&&"answer"==e&&this.createDataChannel()):t.getLocalDescription(e),this},getLocalDescription:function(e){function n(){t.connection["offer"==e?"createOffer":"createAnswer"](function(n){n.sdp=t.serializeSdp(n.sdp,e),t.connection.setLocalDescription(n),t.trickleIce&&t.onSessionDescription(n,t.streaminfo),"offer"==n.type&&m("offer sdp",n.sdp),t.prevCreateType=e},t.onSdpError,t.constraints)}m("(getLocalDescription) peer createType is",e),this.session.inactive&&o(this.rtcMultiConnection.waitUntilRemoteStreamStartsFlowing)&&(this.rtcMultiConnection.waitUntilRemoteStreamStartsFlowing=!1);var t=this;"answer"==e?this.setRemoteDescription(this.offerDescription,n):n()},serializeSdp:function(e,n){if(e=this.processSdp(e),V)return e;if(this.session.inactive&&!this.holdMLine&&(this.hold=!0,(this.session.screen||this.session.video)&&this.session.audio?this.holdMLine="both":this.session.screen||this.session.video?this.holdMLine="video":this.session.audio&&(this.holdMLine="audio")),e=this.setBandwidth(e),"both"==this.holdMLine){if(this.hold)this.prevSDP=e,e=e.replace(/a=sendonly|a=recvonly|a=sendrecv/g,"a=inactive");else if(this.prevSDP&&!this.session.inactive&&(e=this.prevSDP,35>=z))return e}else if("audio"==this.holdMLine||"video"==this.holdMLine){e=e.split("m=");var t="",i="";e[1]&&0==e[1].indexOf("audio")&&(t="m="+e[1]),e[2]&&0==e[2].indexOf("audio")&&(t="m="+e[2]),e[1]&&0==e[1].indexOf("video")&&(i="m="+e[1]),e[2]&&0==e[2].indexOf("video")&&(i="m="+e[2]),"audio"==this.holdMLine&&(this.hold?(this.prevSDP=e[0]+t+i,e=e[0]+t.replace(/a=sendonly|a=recvonly|a=sendrecv/g,"a=inactive")+i):this.prevSDP&&(e=this.prevSDP)),"video"==this.holdMLine&&(this.hold?(this.prevSDP=e[0]+t+i,e=e[0]+t+i.replace(/a=sendonly|a=recvonly|a=sendrecv/g,"a=inactive")):this.prevSDP&&(e=this.prevSDP))}return!this.hold&&this.session.inactive&&(e="offer"==n?e.replace(/a=setup:passive|a=setup:active|a=setup:holdconn/g,"a=setup:actpass"):e.replace(/a=setup:actpass|a=setup:passive|a=setup:holdconn/g,"a=setup:active"),e=e.replace(/a=inactive/g,"a=sendrecv")),e},init:function(){function e(){return n.returnedSDP?void(n.returnedSDP=!1):(n.returnedSDP=!0,void n.onSessionDescription(n.connection.localDescription,n.streaminfo))}this.setConstraints(),this.connection=new an(this.iceServers,this.optionalArgument),this.session.data&&(m("invoked: createDataChannel"),this.createDataChannel()),this.connection.onicecandidate=function(t){return t.candidate?void(n.trickleIce&&n.onicecandidate(t.candidate)):void(n.trickleIce||e())},this.connection.onaddstream=function(e){m("onaddstream",W?e.stream:p(e.stream)),n.onaddstream(e.stream,n.session)},this.connection.onremovestream=function(e){n.onremovestream(e.stream)},this.connection.onsignalingstatechange=function(){n.connection&&n.oniceconnectionstatechange({iceConnectionState:n.connection.iceConnectionState,iceGatheringState:n.connection.iceGatheringState,signalingState:n.connection.signalingState})},this.connection.oniceconnectionstatechange=function(){n.connection&&(n.oniceconnectionstatechange({iceConnectionState:n.connection.iceConnectionState,iceGatheringState:n.connection.iceGatheringState,signalingState:n.connection.signalingState}),n.trickleIce||"complete"==n.connection.iceGatheringState&&(m("iceGatheringState",n.connection.iceGatheringState),e()))};var n=this},setBandwidth:function(e){if(H||V||!this.bandwidth)return e;var n=this.bandwidth;return this.session.screen&&(n.screen?n.screen<300&&f("It seems that you are using wrong bandwidth value for screen. Screen sharing is expected to fail."):f("It seems that you are not using bandwidth for screen. Screen sharing is expected to fail.")),n.screen&&this.session.screen&&(e=e.replace(/b=AS([^\r\n]+\r\n)/g,""),e=e.replace(/a=mid:video\r\n/g,"a=mid:video\r\nb=AS:"+n.screen+"\r\n")),(n.audio||n.video||n.data)&&(e=e.replace(/b=AS([^\r\n]+\r\n)/g,"")),n.audio&&(e=e.replace(/a=mid:audio\r\n/g,"a=mid:audio\r\nb=AS:"+n.audio+"\r\n")),n.video&&(e=e.replace(/a=mid:video\r\n/g,"a=mid:video\r\nb=AS:"+(this.session.screen?n.screen:n.video)+"\r\n")),n.data&&!this.preferSCTP&&(e=e.replace(/a=mid:data\r\n/g,"a=mid:data\r\nb=AS:"+n.data+"\r\n")),e},setConstraints:function(){var e=E({OfferToReceiveAudio:!!this.session.audio,OfferToReceiveVideo:!!this.session.video||!!this.session.screen});if(this.sdpConstraints.mandatory&&(e=E(this.sdpConstraints.mandatory)),this.constraints=e,this.constraints&&m("sdp-constraints",p(this.constraints)),this.optionalArgument={optional:this.optionalArgument.optional||[],mandatory:this.optionalArgument.mandatory||{}},this.preferSCTP||this.optionalArgument.optional.push({RtpDataChannels:!0}),m("optional-argument",p(this.optionalArgument)),o(this.iceServers))this.iceServers=null;else{var n=this.rtcMultiConnection.candidates,t=n.stun,i=n.turn,s=n.host;o(n.reflexive)||(t=n.reflexive),o(n.relay)||(i=n.relay),s||t||!i?s||t||i||(this.rtcConfiguration.iceTransports="none"):this.rtcConfiguration.iceTransports="relay",this.iceServers={iceServers:this.iceServers,iceTransports:this.rtcConfiguration.iceTransports}}m("rtc-configuration",p(this.iceServers))},onSdpError:function(e){var n=p(e);n&&-1!=n.indexOf("RTP/SAVPF Expects at least 4 fields")&&(n="It seems that you are trying to interop RTP-datachannels with SCTP. It is not supported!"),l("onSdpError:",n)},onSdpSuccess:function(){m("sdp success")},onMediaError:function(e){l(p(e))},setRemoteDescription:function(e,n){if(!e)throw"Remote session description should NOT be NULL.";if(this.connection){m("setting remote description",e.type,e.sdp);var t=this;this.connection.setRemoteDescription(new un(e),n||this.onSdpSuccess,function(e){-1==e.search(/STATE_SENTINITIATE|STATE_INPROGRESS/gi)&&t.onSdpError(e)})}},addIceCandidate:function(e){function n(n){t.connection.addIceCandidate(n,function(){m("added:",e.sdpMid,e.candidate)},function(){l("onIceFailure",arguments,e.candidate)})}var t=this;W?mn(e,function(e){n(e)}):n(new mn(e))},createDataChannel:function(e){if(!this.channels||!this.channels.length){var n=this;this.channels||(this.channels=[]);var t={};this.dataChannelDict&&(t=this.dataChannelDict),B&&!this.preferSCTP&&(t.reliable=!1),m("dataChannelDict",p(t)),("answer"==this.type||V)&&(this.connection.ondatachannel=function(e){n.setChannelEvents(e.channel)}),(B&&"offer"==this.type||V)&&this.setChannelEvents(this.connection.createDataChannel(e||"channel",t))}},setChannelEvents:function(e){var n=this;e.binaryType="arraybuffer",this.dataChannelDict.binaryType&&(e.binaryType=this.dataChannelDict.binaryType),e.onmessage=function(e){n.onmessage(e.data)};var t=0;e.onopen=function(){e.push=e.send,e.send=function(i){if("disconnected"!=n.connection.iceConnectionState&&-1==e.readyState.search(/closing|closed/g)&&-1!=e.readyState.search(/connecting|open/g)){if("connecting"==e.readyState)return t++,setTimeout(function(){if(t>=20)throw"Number of times exceeded to wait for WebRTC data connection to be opened.";e.send(i)},1e3);try{e.push(i)}catch(o){if(t++,f("Data transmission failed. Re-transmitting..",t,p(o)),t>=20)throw"Number of times exceeded to resend data packets over WebRTC data channels.";setTimeout(function(){e.send(i)},100)}}},n.onopen(e)},e.onerror=function(e){n.onerror(e)},e.onclose=function(e){n.onclose(e)},this.channels.push(e)},addStream:function(e){e.streamid||j||(e.streamid=t()),m("attaching stream:",e.streamid,W?e:p(e)),this.connection.addStream(e),this.sendStreamId(e),this.getStreamInfo()},attachMediaStreams:function(){for(var e=this.attachStreams,n=0;n<e.length;n++)this.addStream(e[n])},getStreamInfo:function(){this.streaminfo="";for(var e=this.connection.getLocalStreams(),n=0;n<e.length;n++)0==n?this.streaminfo=JSON.stringify({streamid:e[n].streamid||"",isScreen:!!e[n].isScreen,isAudio:!!e[n].isAudio,isVideo:!!e[n].isVideo,preMuted:e[n].preMuted||{}}):this.streaminfo+="----"+JSON.stringify({streamid:e[n].streamid||"",isScreen:!!e[n].isScreen,isAudio:!!e[n].isAudio,isVideo:!!e[n].isVideo,preMuted:e[n].preMuted||{}})},recreateOffer:function(e,n){m("recreating offer"),this.type="offer",this.session=e,this.onSessionDescription=n,this.getStreamInfo(),this.session.data&&this.createDataChannel(),this.getLocalDescription("offer")},recreateAnswer:function(e,n,t){m("recreating answer"),this.type="answer",this.session=n,this.onSessionDescription=t,this.offerDescription=e,this.getStreamInfo(),this.session.data&&this.createDataChannel(),this.getLocalDescription("answer")}}}function P(e,n){var t=document.createElement("a");t.href=e,t.target="_blank",t.download=n||e,navigator.mozGetUserMedia&&(t.onclick=function(){(document.body||document.documentElement).removeChild(t)},(document.body||document.documentElement).appendChild(t));var i=new MouseEvent("click",{view:window,bubbles:!0,cancelable:!0});t.dispatchEvent(i),navigator.mozGetUserMedia||URL.revokeObjectURL(t.href)}function I(e){function n(n,i,o){var s=n.uuid;if(t[s]||(t[s]=[]),t[s].push(n.message),n.last){var r=t[s].join("");n.isobject&&(r=JSON.parse(r));var a=(new Date).getTime(),d=a-n.sendingTime,c={data:r,userid:i,extra:o,latency:d};r.preRecordedMediaChunk?(e.preRecordedMedias[r.streamerid]||e.shareMediaFile(null,null,r.streamerid),e.preRecordedMedias[r.streamerid].onData(r.chunk)):e.autoTranslateText?(c.original=c.data,e.Translator.TranslateText(c.data,function(n){c.data=n,e.onmessage(c)})):r.isPartOfScreen?e.onpartofscreen(r):e.onmessage(c),delete t[s]}}var t={};return{receive:n}}function U(e,n){window.removeEventListener(e,n),window.addEventListener(e,n,!1)}function L(e){function i(e,n){if(-1!=e.position){var t=+e.position.toFixed(2).split(".")[1]||100;n.innerHTML=t+"%"}}e.userid=t(),e.session={audio:!0,video:!0},e.maxParticipantsAllowed=256,e.direction="many-to-many",e.mediaConstraints={mandatory:{},optional:[],audio:{mandatory:{},optional:[]},video:{mandatory:{},optional:[]}},e.candidates={host:!0,stun:!0,turn:!0},e.sdpConstraints={},e.sdpConstraints.mandatory={OfferToReceiveAudio:!0,OfferToReceiveVideo:!0},e.privileges={canStopRemoteStream:!1,canMuteRemoteStream:!1},e.iceProtocols={tcp:!0,udp:!0},e.preferSCTP=V||z>=32?!0:!1,e.chunkInterval=V||z>=32?100:500,e.chunkSize=V||z>=32?13e3:1e3,e.fakeDataChannels=!1,e.waitUntilRemoteStreamStartsFlowing=null,e.leaveOnPageUnload=!0,e.getExternalIceServers=B,e.UA={isFirefox:V,isChrome:B,isMobileDevice:H,version:B?z:J,isNodeWebkit:q,isSafari:_,isIE:j,isOpera:F},e.fileQueue={},e.renegotiatedSessions={},e.channels={},e.extra={},e.bandwidth={screen:300},e.caniuse={RTCPeerConnection:DetectRTC.isWebRTCSupported,getUserMedia:!!navigator.webkitGetUserMedia||!!navigator.mozGetUserMedia,AudioContext:DetectRTC.isAudioContextSupported,ScreenSharing:DetectRTC.isScreenCapturingSupported,RtpDataChannels:DetectRTC.isRtpDataChannelsSupported,SctpDataChannels:DetectRTC.isSctpDataChannelsSupported},e.snapshots={},e._mediaSources={},e.devices={},e.language="en",e.autoTranslateText=!1,e.googKey="AIzaSyCgB5hmFY74WYB-EoWkhr9cAGr6TiTHrEE",e.localStreamids=[],e.localStreams={},e.preRecordedMedias={},e.attachStreams=[],e.detachStreams=[],e.optionalArgument={optional:[{DtlsSrtpKeyAgreement:!0},{googImprovedWifiBwe:!0},{googScreencastMinBitrate:300}],mandatory:{}},e.dataChannelDict={},e.dontAttachStream=!1,e.dontCaptureUserMedia=!1,e.preventSSLAutoAllowed=!1,e.autoReDialOnFailure=!0,e.isInitiator=!1,e.DetectRTC=DetectRTC,e.trickleIce=!0,e.sessionDescriptions={},e.sessionDescription=null,e.resources={RecordRTC:"https://cdn.webrtc-experiment.com/RecordRTC.js",PreRecordedMediaStreamer:"https://cdn.webrtc-experiment.com/PreRecordedMediaStreamer.js",customGetUserMediaBar:"https://cdn.webrtc-experiment.com/navigator.customGetUserMediaBar.js",html2canvas:"https://cdn.webrtc-experiment.com/screenshot.js",hark:"https://cdn.webrtc-experiment.com/hark.js",firebase:"https://cdn.webrtc-experiment.com/firebase.js",firebaseio:"https://webrtc-experiment.firebaseIO.com/",muted:"https://cdn.webrtc-experiment.com/images/muted.png",getConnectionStats:"https://cdn.webrtc-experiment.com/getConnectionStats.js",FileBufferReader:"https://cdn.webrtc-experiment.com/FileBufferReader.js"},e.body=document.body||document.documentElement,e.peers={},e.firebase="chat",e.numberOfSessions=0,e.numberOfConnectedUsers=0,e.enableFileSharing=!0,e.autoSaveToDisk=!1,e.processSdp=function(e){return e},e.onmessage=function(e){m("onmessage",p(e))},e.onopen=function(e){m("Data connection is opened between you and",e.userid)},e.onerror=function(e){l(onerror,p(e))},e.onclose=function(n){f("onclose",p(n)),e.streams.remove({userid:n.userid})};var a={};e.onFileStart=function(n){var t=document.createElement("div");t.title=n.name,t.innerHTML="<label>0%</label> <progress></progress>",e.body.insertBefore(t,e.body.firstChild),a[n.uuid]={div:t,progress:t.querySelector("progress"),label:t.querySelector("label")},a[n.uuid].progress.max=n.maxChunks},e.onFileProgress=function(e){var n=a[e.uuid];n&&(n.progress.value=e.currentPosition||e.maxChunks||n.progress.max,i(n.progress,n.label))},e.onFileEnd=function(n){a[n.uuid]&&(a[n.uuid].div.innerHTML='<a href="'+n.url+'" target="_blank" download="'+n.name+'">'+n.name+"</a>"),(e.onFileSent||e.onFileReceived)&&(e.onFileSent&&e.onFileSent(n,n.uuid),e.onFileReceived&&e.onFileReceived(n.name,n))},e.onstream=function(n){e.body.insertBefore(n.mediaElement,e.body.firstChild)},e.onstreamended=function(e){if(m("onStreamEndedHandler:",e),!e.mediaElement)return f("Event.mediaElement is undefined",e);if(!e.mediaElement.parentNode){if(e.mediaElement=document.getElementById(e.streamid),!e.mediaElement)return f("Event.mediaElement is undefined",e);if(!e.mediaElement.parentNode)return f("Event.mediElement.parentNode is null.",e)}e.mediaElement.parentNode.removeChild(e.mediaElement)},e.onSessionClosed=function(e){e.isEjected?f(e.userid,"ejected you."):f("Session has been closed.",e)},e.onmute=function(n){n.isVideo&&n.mediaElement&&(n.mediaElement.pause(),n.mediaElement.setAttribute("poster",n.snapshot||e.resources.muted)),n.isAudio&&n.mediaElement&&(n.mediaElement.muted=!0)},e.onunmute=function(e){e.isVideo&&e.mediaElement&&(e.mediaElement.play(),e.mediaElement.removeAttribute("poster")),e.isAudio&&e.mediaElement&&(e.mediaElement.muted=!1)},e.onleave=function(e){m("onleave",p(e))},e.token=t,e.peers[e.userid]={drop:function(){e.drop()},renegotiate:function(){},addStream:function(){},hold:function(){},unhold:function(){},changeBandwidth:function(){},sharePartOfScreen:function(){}},e._skip=["stop","mute","unmute","_private","_selectStreams","selectFirst","selectAll","remove"],e.streams={mute:function(e){this._private(e,!0)},unmute:function(e){this._private(e,!1)},_private:function(n,t){function i(e,n,t){n.local&&"local"!=e.type||n.remote&&"remote"!=e.type||!(n.isScreen&&!e.isScreen||n.isAudio&&!e.isAudio||n.isVideo&&!e.isVideo||(t?!e.mute(n):!e.unmute(n)))}if(!n||s(n))for(var o in this)-1==e._skip.indexOf(o)&&this[o]._private(n,t);else for(var o in this)-1==e._skip.indexOf(o)&&i(this[o],n,t)},stop:function(n){function t(e,n){n.userid&&e.userid!=n.userid||n.local&&"local"!=e.type||n.remote&&"remote"!=e.type||(n.screen&&e.isScreen&&e.stop(),n.audio&&e.isAudio&&e.stop(),n.video&&e.isVideo&&e.stop(),n.audio||n.video||n.screen||e.stop())}var i;for(var o in this)if(-1==e._skip.indexOf(o))if(i=this[o],n)if(s(n)){var r={};r[n]=!0,t(i,r)}else t(i,n);else i.stop()},remove:function(n){function t(e,n){n.userid&&e.userid!=n.userid||n.local&&"local"!=e.type||n.remote&&"remote"!=e.type||(n.screen&&e.isScreen&&i(e),n.audio&&e.isAudio&&i(e),n.video&&e.isVideo&&i(e),n.audio||n.video||n.screen||i(e))}function i(n){g(n,e),delete e.streams[n.streamid]}var o;for(var r in this)if(-1==e._skip.indexOf(r))if(o=this[r],n)if(s(n)){var a={};a[n]=!0,t(o,a)}else t(o,n);else t(o,{local:!0,remote:!0})},selectFirst:function(e){return this._selectStreams(e,!1)},selectAll:function(e){return this._selectStreams(e,!0)},_selectStreams:function(n,t){if(!n||s(n)||r(n))throw"Invalid arguments.";o(n.local)&&o(n.remote)&&o(n.userid)&&(n.local=n.remote=!0),n.isAudio||n.isVideo||n.isScreen||(n.isAudio=n.isVideo=n.isScreen=!0);var i=[];for(var a in this)-1==e._skip.indexOf(a)&&(a=this[a])&&(n.local&&"local"==a.type||n.remote&&"remote"==a.type||n.userid&&a.userid==n.userid)&&(n.isVideo&&a.isVideo&&i.push(a),n.isAudio&&a.isAudio&&i.push(a),n.isScreen&&a.isScreen&&i.push(a));return t?i:i[0]}};var d=[];d.push({url:"stun:stun.l.google.com:19302"}),d.push({url:"stun:stun.anyfirewall.com:3478"}),d.push({url:"turn:turn.bistri.com:80",credential:"homeo",username:"homeo"}),d.push({url:"turn:turn.anyfirewall.com:443?transport=tcp",credential:"webrtc",username:"webrtc"}),e.iceServers=d,e.rtcConfiguration={iceServers:null,iceTransports:"all",peerIdentity:!1},e.media={min:function(n,t){e.mediaConstraints.video&&(e.mediaConstraints.video.mandatory||(e.mediaConstraints.video.mandatory={}),e.mediaConstraints.video.mandatory.minWidth=n,e.mediaConstraints.video.mandatory.minHeight=t)},max:function(n,t){e.mediaConstraints.video&&(e.mediaConstraints.video.mandatory||(e.mediaConstraints.video.mandatory={}),e.mediaConstraints.video.mandatory.maxWidth=n,e.mediaConstraints.video.mandatory.maxHeight=t)}},e._getStream=function(n){function t(e,n,t){if(t){var i=t.onpause,o=t.onplay;t.onpause=t.onplay=function(){},n?t.pause():t.play(),t.onpause=i,t.onplay=o}}var i=b({sockets:n.socket?[n.socket]:[]},n);return i.stop=function(){var e=this;if(e.sockets.forEach(function(n){"local"==e.type&&n.send({streamid:e.streamid,stopped:!0}),"remote"==e.type&&n.send({promptStreamStop:!0,streamid:e.streamid})}),"remote"!=e.type){var n=e.stream;n&&e.rtcMultiConnection.stopMediaStream(n)}},i.mute=function(e){this.muted=!0,this._private(e,!0)},i.unmute=function(e){this.muted=!1,this._private(e,!1)},i._private=function(e,n){return e&&!o(e.sync)&&0==e.sync?void t(e,n,this.mediaElement):void M({root:this,session:e,enabled:n,stream:this.stream})},i.startRecording=function(n){var t=this;return n||(n={audio:!0,video:!0}),s(n)&&(n={audio:"audio"==n,video:"video"==n}),window.RecordRTC?(m("started recording session",n),t.videoRecorder=t.audioRecorder=null,V?t.stream.getAudioTracks().length&&t.stream.getVideoTracks().length?t.videoRecorder=RecordRTC(t.stream,{type:"video"}):n.video?t.videoRecorder=RecordRTC(t.stream,{type:"video"}):n.audio&&(t.audioRecorder=RecordRTC(t.stream,{type:"audio"})):B&&(isMediaRecorderCompatible()&&e.DetectRTC.browser.version>=50&&t.stream.getAudioTracks().length&&t.stream.getVideoTracks().length?t.videoRecorder=RecordRTC(t.stream,{type:"video"}):isMediaRecorderCompatible()&&e.DetectRTC.browser.version>=50?n.video?t.videoRecorder=RecordRTC(t.stream,{type:"video"}):n.audio&&(t.audioRecorder=RecordRTC(t.stream,{type:"audio"})):(n.video&&(t.videoRecorder=RecordRTC(t.stream,{type:"video"})),n.audio&&(t.audioRecorder=RecordRTC(t.stream,{type:"audio"})))),t.audioRecorder&&t.audioRecorder.startRecording(),void(t.videoRecorder&&t.videoRecorder.startRecording())):y(t.rtcMultiConnection.resources.RecordRTC,function(){t.startRecording(n)})},i.stopRecording=function(e,n){n||(n={audio:!0,video:!0}),s(n)&&(n={audio:"audio"==n,video:"video"==n}),m("stopped recording session",n);var t=this;n.audio&&t.audioRecorder?t.audioRecorder.stopRecording(function(){n.video&&t.videoRecorder?t.videoRecorder.stopRecording(function(){e({audio:t.audioRecorder.getBlob(),video:t.videoRecorder.getBlob()})}):e({audio:t.audioRecorder.getBlob()})}):n.video&&t.videoRecorder&&t.videoRecorder.stopRecording(function(){e({video:t.videoRecorder.getBlob()})})},i.takeSnapshot=function(n){w({mediaElement:this.mediaElement,userid:this.userid,connection:e,callback:n})},i.streamObject=i,i},e.set=function(e){for(var n in e)this[n]=e[n];return this},e.onMediaError=function(e){l("name",e.name),l("constraintName",p(e.constraintName)),l("message",e.message),l("original session",e.session)},e.takeSnapshot=function(n,t){w({userid:n,connection:e,callback:t})},e.saveToDisk=function(e,n){e.size&&e.type?ln.SaveToDisk(URL.createObjectURL(e),n||e.name||e.type.replace("/","-")+e.type.split("/")[1]):ln.SaveToDisk(e,n)},e.selectDevices=function(n,t){function i(n){n&&(e._mediaSources[n.kind]=n.id)}n&&i(this.devices[n]),t&&i(this.devices[t])},e.getDevices=function(n){return DetectRTC.MediaDevices.length?(DetectRTC.MediaDevices.forEach(function(n){e.devices[n.deviceId]=n}),void(n&&n(e.devices))):setTimeout(function(){e.getDevices(n)},1e3)},e.getMediaDevices=e.enumerateDevices=function(n){if(!n)throw"callback is mandatory.";e.getDevices(function(){n(e.DetectRTC.MediaDevices)})},e.onCustomMessage=function(e){m("Custom message",e)},e.ondrop=function(e){m("Media connection is dropped by "+e)},e.drop=function(n){n=n||{},e.attachStreams=[];for(var t in e.streams)-1==e._skip.indexOf(t)&&(t=e.streams[t],"local"==t.type?(e.detachStreams.push(t.streamid),g(t,e)):g(t,e));e.sendCustomMessage({drop:!0,dontRenegotiate:o(n.renegotiate)?!0:n.renegotiate})},e.Translator={TranslateText:function(n,t){var i=document.createElement("script");i.type="text/javascript";var o=encodeURIComponent(n),s="method"+e.token();window[s]=function(e){e.data&&e.data.translations[0]&&t&&t(e.data.translations[0].translatedText),e.error&&"Daily Limit Exceeded"==e.error.message&&(f('Text translation failed. Error message: "Daily Limit Exceeded."'),t(n))};var r="https://www.googleapis.com/language/translate/v2?key="+e.googKey+"&target="+(e.language||"en-US")+"&callback=window."+s+"&q="+o;i.src=r,document.getElementsByTagName("head")[0].appendChild(i)}},e.setDefaultEventsForMediaElement=function(n,t){n.onpause=function(){e.streams[t]&&!e.streams[t].muted&&e.streams[t].mute()},n.onplay=function(){e.streams[t]&&e.streams[t].muted&&e.streams[t].unmute()};var i=!1;n.onvolumechange=function(){i||(i=!0,e.streams[t]&&setTimeout(function(){var o=e.streams[t];e.streams[t].sockets.forEach(function(e){e.send({streamid:o.streamid,isVolumeChanged:!0,volume:n.volume})}),i=!1},2e3))}},e.onMediaFile=function(n){m("onMediaFile",n),e.body.appendChild(n.mediaElement)},e.shareMediaFile=function(n,t,i){return i=i||e.token(),PreRecordedMediaStreamer?PreRecordedMediaStreamer.shareMediaFile({file:n,video:t,streamerid:i,connection:e}):(y(e.resources.PreRecordedMediaStreamer,function(){e.shareMediaFile(n,t,i)}),i)},e.onpartofscreen=function(n){var t=document.createElement("img");t.src=n.screenshot,e.body.appendChild(t)},e.skipLogs=function(){m=l=f=function(){}},e.hold=function(n){for(var t in e.peers)e.peers[t].hold(n)},e.onhold=function(n){m("onhold",n),"audio"!=n.kind&&(n.mediaElement.pause(),n.mediaElement.setAttribute("poster",n.screenshot||e.resources.muted)),"audio"==n.kind&&(n.mediaElement.muted=!0)},e.unhold=function(n){for(var t in e.peers)e.peers[t].unhold(n)},e.onunhold=function(e){m("onunhold",e),"audio"!=e.kind&&(e.mediaElement.play(),e.mediaElement.removeAttribute("poster")),"audio"!=e.kind&&(e.mediaElement.muted=!1)},e.sharePartOfScreen=function(n){function t(){(!e.partOfScreen||e.partOfScreen.sharing)&&T({element:n.element,connection:e,callback:function(o){if(o!=i){i=o;for(var s in e.channels)e.channels[s].send({screenshot:o,isPartOfScreen:!0})}!n.once&&setTimeout(t,n.interval||200)}})}var i="";t(),e.partOfScreen=b({sharing:!0},n)},e.pausePartOfScreenSharing=function(){for(var n in e.peers)e.peers[n].pausePartOfScreenSharing=!0;e.partOfScreen&&(e.partOfScreen.sharing=!1)},e.resumePartOfScreenSharing=function(){for(var n in e.peers)e.peers[n].pausePartOfScreenSharing=!1;e.partOfScreen&&(e.partOfScreen.sharing=!0)},e.stopPartOfScreenSharing=function(){for(var n in e.peers)e.peers[n].stopPartOfScreenSharing=!0;e.partOfScreen&&(e.partOfScreen.sharing=!1)},e.takeScreenshot=function(n,t){if(!n||!t)throw"Invalid number of arguments.";if(!window.html2canvas)return y(e.resources.html2canvas,function(){e.takeScreenshot(n)});if(s(n)&&(n=document.querySelector(n),n||(n=document.getElementById(n))),!n)throw"HTML Element is inaccessible!";html2canvas(n,{onrendered:function(e){t(e.toDataURL())}})},e.onScreenCapturingExtensionAvailable=function(){m("It seems that screen capturing extension is installed and available on your system!")},!W&&DetectRTC.screen.onScreenCapturingExtensionAvailable&&(DetectRTC.screen.onScreenCapturingExtensionAvailable=function(){e.onScreenCapturingExtensionAvailable()}),e.changeBandwidth=function(n){for(var t in e.peers)e.peers[t].changeBandwidth(n)},e.convertToAudioStream=function(e){n(e)},e.onstatechange=function(e){m("on:state:change ("+e.userid+"):",e.name+":",e.reason||"")},e.onfailed=function(e){e.peer.numOfRetries||(e.peer.numOfRetries=0),e.peer.numOfRetries++,l("ICE connectivity check is failed. Renegotiating peer connection."),e.peer.numOfRetries<2&&e.peer.renegotiate(),e.peer.numOfRetries<2||(e.peer.numOfRetries=0)},e.onconnected=function(e){m("Peer connection has been established between you and",e.userid)},e.ondisconnected=function(n){l("Peer connection seems has been disconnected between you and",n.userid),r(e.channels)||e.channels[n.userid]&&(e.channels[n.userid].send({checkingPresence:!0}),setTimeout(function(){return e.peers[n.userid].connected?void delete e.peers[n.userid].connected:(e.streams.remove({remote:!0,userid:n.userid}),void e.remove(n.userid))},3e3))},e.onstreamid=function(e){m("got remote streamid",e.streamid,"from",e.userid)},e.stopMediaStream=function(n){if(!n)throw"MediaStream argument is mandatory.";if(e.keepStreamsOpened)return void(n.onended&&n.onended());e.localStreams[n.streamid]&&delete e.localStreams[n.streamid],V&&n.onended&&n.onended();var t=!(!n.getAudioTracks&&!n.getVideoTracks||!(n.getAudioTracks()[0]&&!n.getAudioTracks()[0].stop||n.getVideoTracks()[0]&&!n.getVideoTracks()[0].stop));return!n.getAudioTracks||t?void(n.stop&&n.stop()):(n.getAudioTracks().length&&n.getAudioTracks()[0].stop&&n.getAudioTracks().forEach(function(e){e.stop()}),void(n.getVideoTracks().length&&n.getVideoTracks()[0].stop&&n.getVideoTracks().forEach(function(e){e.stop()})))},e.changeBandwidth=function(n){if(!n||s(n)||r(n))throw'Invalid "bandwidth" arguments.';u(e.peers,function(e){e.peer.bandwidth=n}),e.renegotiate()},e.openSignalingChannel=function(n){if(!window.Firebase)return y(e.resources.firebase,function(){e.openSignalingChannel(n)});var t=n.channel||e.channel;e.firebase&&(e.resources.firebaseio=e.resources.firebaseio.replace("//chat.","//"+e.firebase+"."));var i=new Firebase(e.resources.firebaseio+t);i.channel=t,i.on("child_added",function(e){n.onmessage(e.val())}),i.send=function(e){for(var n in e)(o(e[n])||"function"==typeof e[n])&&(e[n]=!1);this.push(e)},e.socket||(e.socket=i),i.onDisconnect().remove(),setTimeout(function(){n.callback(i)},1)},e.Plugin=sn}window.RMCDefaultChannel=location.href.replace(/\/|:|#|\?|\$|\^|%|\.|`|~|!|\+|@|\[|\||]|\|*. /g,"").split("\n").join("").split("\r").join(""),window.RTCMultiConnection=function(a){function d(n){return Q&&R(),w?n():void(w=new e(T,n))
}function u(e,n){if(s(e)&&(T.skipOnNewSession=!0),!w)return m("Signaling channel is not ready. Connecting..."),void d(function(){m("Signaling channel is connected. Joining the session again..."),setTimeout(function(){u(e,n)},1e3)});if(s(e)){if(!T.sessionDescriptions[e])return setTimeout(function(){m("Session-Descriptions not found. Rechecking.."),u(e,n)},1e3);e=T.sessionDescriptions[e]}if(n)return h(function(){e.oneway=!0,u(e)},n);if(!e||!e.userid||!e.sessionid){t("missing arguments",arguments);var t='Invalid data passed over "connection.join" method.';throw T.onstatechange({userid:"browser",extra:{},name:"Unexpected data detected.",reason:t}),t}T.dontOverrideSession||(T.session=e.session);var o=T.extra||e.extra||{};e.oneway||i(e)?w.joinSession(e,o):h(function(){w.joinSession(e,o)})}function h(e,n,t){function o(t){if(t.data&&t.data.chromeMediaSourceId){window.removeEventListener("message",o);var i=t.data.chromeMediaSourceId;if(DetectRTC.screen.sourceId=i,DetectRTC.screen.chromeMediaSource="desktop","PermissionDeniedError"==i){var s={message:"https:"==location.protocol?"User denied to share content of his screen.":nn,name:"PermissionDeniedError",constraintName:u,session:d};return cn.mutex=!1,DetectRTC.screen.sourceId=null,T.onMediaError(s)}h(e,n)}t.data&&t.data.chromeExtensionStatus&&(f("Screen capturing extension status is:",t.data.chromeExtensionStatus),DetectRTC.screen.chromeMediaSource="screen",h(e,n,!0))}function a(n,t,i,o){if(T.onstatechange({userid:"browser",extra:{},name:"fetching-usermedia",reason:"About to capture user-media with constraints: "+p(n)}),T.preventSSLAutoAllowed&&!o&&B)return navigator.customGetUserMediaBar?void navigator.customGetUserMediaBar(n,function(){a(n,t,i,!0)},function(){T.onMediaError({name:"PermissionDeniedError",message:"User denied permission.",constraintName:n,session:d})}):void y(T.resources.customGetUserMediaBar,function(){a(n,t,i,o)});var r={onsuccess:function(e,o,s,r){S(e,o,s,r,n,t,i,u,c,d)},onerror:function(n,t){if(V&&"PERMISSION_DENIED"==n&&(n={message:"",name:"PermissionDeniedError",constraintName:t,session:d}),V&&t.video&&t.video.mozMediaSource)return i={message:en,name:n.name||"PermissionDeniedError",constraintName:t,session:d},void T.onMediaError(i);if(s(n))return T.onMediaError({message:"Unknown Error",name:n,constraintName:t,session:d});if(n.name&&("PermissionDeniedError"==n.name||"DevicesNotFoundError"==n.name)){var i="Either: ";i+="\n Media resolutions are not permitted.",i+="\n Another application is using same media device.",i+="\n Media device is not attached or drivers not installed.",i+="\n You denied access once and it is still denied.",n.message&&n.message.length&&(i+="\n "+n.message),i={message:i,name:n.name,constraintName:t,session:d},T.onMediaError(i),B&&(d.audio||d.video)&&DetectRTC.load(function(){d.audio&&!DetectRTC.hasMicrophone&&(f("It seems that you have no microphone attached to your device/system."),d.audio=d.audio=!1,d.video||(alert("It seems that you are capturing microphone and there is no device available or access is denied. Reloading..."),location.reload())),d.video&&!DetectRTC.hasWebcam&&(f("It seems that you have no webcam attached to your device/system."),d.video=d.video=!1,d.audio||(alert("It seems that you are capturing webcam and there is no device available or access is denied. Reloading..."),location.reload())),DetectRTC.hasMicrophone||DetectRTC.hasWebcam?T.getUserMediaPromptedOnce||(T.getUserMediaPromptedOnce=!0,h(e,d)):(alert("It seems that either both microphone/webcam are not available or access is denied. Reloading..."),location.reload())})}if(n.name&&"ConstraintNotSatisfiedError"==n.name){var i="Either: ";i+="\n You are prompting unknown media resolutions.",i+="\n You are using invalid media constraints.",n.message&&n.message.length&&(i+="\n "+n.message),i={message:i,name:n.name,constraintName:t,session:d},T.onMediaError(i)}d.screen&&(V?l(en):"https:"!==location.protocol?q||"file:"!=location.protocol&&"http:"!=location.protocol||l("You cannot use HTTP or file protocol for screen capturing. You must either use HTTPs or chrome extension page or Node-Webkit page."):l('Unable to detect actual issue. Maybe "deprecated" screen capturing flag was not set using command line or maybe you clicked "No" button or maybe chrome extension returned invalid "sourceId". Please install chrome-extension: http://bit.ly/webrtc-screen-extension')),cn.mutex=!1;var o=JSON.stringify(t);cn.streams[o]&&delete cn.streams[o]},mediaConstraints:T.mediaConstraints||{}};r.constraints=n||c,r.connection=T,O(r)}var d=n||T.session;if(r(d))return void(e&&e());if(T.dontCaptureUserMedia)return e();if(i(d)||!T.isInitiator&&d.oneway)return T.attachStreams=[],e();var c={audio:d.audio?{mandatory:{},optional:[{chromeRenderToAssociatedSink:!0}]}:!1,video:!!d.video};if(T._mediaSources.audio&&c.audio.optional.push({sourceId:T._mediaSources.audio}),T._mediaSources.audiooutput&&c.audio.optional.push({sourceId:T._mediaSources.audiooutput}),T._mediaSources.audioinput&&c.audio.optional.push({sourceId:T._mediaSources.audioinput}),T._mediaSources.video&&(c.video={optional:[{sourceId:T._mediaSources.video}]}),T._mediaSources.videoinput&&(c.video={optional:[{sourceId:T._mediaSources.videoinput}]}),!d.screen&&!c.audio&&!c.video)return e();var u={audio:!1,video:{mandatory:{chromeMediaSource:DetectRTC.screen.chromeMediaSource,maxWidth:screen.width>1920?screen.width:1920,maxHeight:screen.height>1080?screen.height:1080},optional:[]}};if(V&&d.screen){if("https:"!==location.protocol)return l(nn);f(en),u.video={mozMediaSource:"window",mediaSource:"window"},c.audio&&(u.audio=!0,c={}),delete u.video.chromeMediaSource}if(d.screen){if(B&&DetectRTC.screen.extensionid!=tn&&(on=!0),B&&!on&&!t&&!DetectRTC.screen.sourceId)return U("message",o),Q||R(),void Q.postMessage();if(B&&on&&!t&&"screen"==DetectRTC.screen.chromeMediaSource&&DetectRTC.screen.extensionid)return DetectRTC.screen.extensionid==tn&&-1==document.domain.indexOf("webrtc-experiment.com")?h(e,n,!0):(m("checking if chrome extension is installed."),void DetectRTC.screen.getChromeExtensionStatus(function(t){"installed-enabled"==t&&(DetectRTC.screen.chromeMediaSource="desktop"),h(e,n,!0),m("chrome extension is installed?","desktop"==DetectRTC.screen.chromeMediaSource)}));if(B&&on&&"desktop"==DetectRTC.screen.chromeMediaSource&&!DetectRTC.screen.sourceId)return void DetectRTC.screen.getSourceId(function(t){if("PermissionDeniedError"==t){var i={message:"User denied to share content of his screen.",name:"PermissionDeniedError",constraintName:u,session:d};return cn.mutex=!1,DetectRTC.screen.chromeMediaSource="desktop",T.onMediaError(i)}return"No-Response"==t?(l("Chrome extension seems not available. Make sure that manifest.json#L16 has valid content-script matches pointing to your URL."),DetectRTC.screen.chromeMediaSource="screen",h(e,n,!0)):void h(e,n,!0)});B&&"desktop"==DetectRTC.screen.chromeMediaSource&&(u.video.mandatory.chromeMediaSourceId=DetectRTC.screen.sourceId);var v=x;a(u,c.audio||c.video?function(){v&&(x=!0),a(c,e)}:e)}else a(c,e,d.audio&&!d.video)}function S(e,i,o,s,r,a,d,u,m,l){s||(s=t()),T.onstatechange({userid:"browser",extra:{},name:"usermedia-fetched",reason:"Captured user media using constraints: "+p(r)}),d&&(e=n(e)),T.localStreamids.push(s),e.onended=function(){h.mediaElement&&!h.mediaElement.parentNode&&document.getElementById(e.streamid)&&(h.mediaElement=document.getElementById(e.streamid)),T.attachStreams.forEach(function(n,t){n==e&&(delete T.attachStreams[t],T.attachStreams=c(T.attachStreams))}),g(h,T),T.streams[s]&&T.removeStream(s);var n=T.streams[s];n&&n.sockets.length&&n.sockets.forEach(function(e){e.send({streamid:n.streamid,stopped:!0})}),cn.mutex=!1,cn.streams[o]&&delete cn.streams[o],DetectRTC.screen.sourceId=null},j||(e.streamid=s,e.isScreen=r==u,e.isVideo=r==m&&!!m.video,e.isAudio=r==m&&!!m.audio&&!m.video,e.preMuted={audio:e.getAudioTracks().length&&!e.getAudioTracks()[0].enabled,video:e.getVideoTracks().length&&!e.getVideoTracks()[0].enabled});var f=v(e,l);f.muted=!0;var h={stream:e,streamid:s,mediaElement:f,blobURL:f.mozSrcObject?URL.createObjectURL(e):f.src,type:"local",userid:T.userid,extra:T.extra,session:l,isVideo:!!e.isVideo,isAudio:!!e.isAudio,isScreen:!!e.isScreen,isInitiator:!!T.isInitiator,rtcMultiConnection:T};x&&T.attachStreams.push(e),x=!1,T.streams[s]=T._getStream(h),i||T.onstream(h),T.setDefaultEventsForMediaElement&&T.setDefaultEventsForMediaElement(f,s),a&&a(e,h),T.onspeaking&&D({stream:e,streamedObject:h,connection:T})}var w,T=this;T.channel=a||RMCDefaultChannel,T.isAcceptNewSession=!0,T.open=function(e){T.isAcceptNewSession=!1,T.isInitiator=!0;var n=!1;return e&&(s(e)?T.sessionid=e:(o(e.transmitRoomOnce)||(T.transmitRoomOnce=e.transmitRoomOnce),o(e.dontTransmit)||(n=e.dontTransmit),o(e.sessionid)||(T.sessionid=e.sessionid))),T.socket&&T.socket.remove&&T.socket.remove(),T.sessionid||(T.sessionid=T.channel),T.sessionDescription={sessionid:T.sessionid,userid:T.userid,session:T.session,extra:T.extra},T.sessionDescriptions[T.sessionDescription.sessionid]||(T.numberOfSessions++,T.sessionDescriptions[T.sessionDescription.sessionid]=T.sessionDescription),d(function(){w.captureUserMediaOnDemand=e?!!e.captureUserMediaOnDemand:!1,e&&e.onMediaCaptured&&(T.onMediaCaptured=e.onMediaCaptured),w.captureUserMediaOnDemand||h(function(){w.initSession({sessionDescription:T.sessionDescription,dontTransmit:n}),C(T)}),w.captureUserMediaOnDemand&&w.initSession({sessionDescription:T.sessionDescription,dontTransmit:n})}),T.sessionDescription},T.connect=function(e){return e&&(T.sessionid=e),d(function(){m("Signaling channel is ready.")}),this},T.join=u,T.send=function(e,n){if(T.numberOfConnectedUsers<=0)return void setTimeout(function(){T.send(e,n)},1e3);if(!e)throw"No file, data or text message to share.";if(e instanceof Array&&!o(e[0].size)&&!o(e[0].type))for(var t=0;t<e.length;t++)e[t].size&&e[t].type&&T.send(e[t],n);else if(o(e.size)||o(e.type))fn.send({text:e,channel:w,_channel:n,connection:T});else{if(!T.enableFileSharing)throw'"enableFileSharing" boolean MUST be "true" to support file sharing.';if(!w.fileBufferReader)return void k(T,function(t){w.fileBufferReader=t,T.send(e,n)});var i=b({userid:T.userid},e.extra||T.extra);w.fileBufferReader.readAsArrayBuffer(e,function(e){w.fileBufferReader.getNextChunk(e,function(e){n?n.send(e):w.send(e)})},i)}},T.disconnect=function(){w&&w.disconnect(),w=null};var x=!0;T.captureUserMedia=h,T.leave=function(e){return w?(x=!0,e?void T.eject(e):void w.leave()):void 0},T.eject=function(e){if(!T.isInitiator)throw"Only session-initiator can eject a user.";if(!T.peers[e])throw"You ejected invalid user.";T.peers[e].sendCustomMessage({ejected:!0})},T.close=function(){T.autoCloseEntireSession=!0,T.leave()},T.renegotiate=function(e,n){return T.numberOfConnectedUsers>0?void w.addStream({renegotiate:n||b({oneway:!0},T.session),stream:e}):void setTimeout(function(){T.renegotiate(e,n)},1e3)},T.attachExternalStream=function(e,n){var t={};e.getAudioTracks&&e.getAudioTracks().length&&(t.audio=!0),e.getVideoTracks&&e.getVideoTracks().length&&(t.video=!0);var i={video:{chromeMediaSource:"fake"}},o=n?i:t;S(e,!1,"",null,o,!1,!1,i,t,t)},T.addStream=function(e,n){function t(t){w.addStream({stream:t,renegotiate:e||T.session,socket:n})}if(T.numberOfConnectedUsers<=0)return void setTimeout(function(){T.addStream(e,n)},1e3);if(e){var i;!T.isInitiator&&e.oneway&&(e.oneway=!1,i=!0),h(function(n){i&&(e.oneway=!0),t(n)},e)}else t()},T.removeStream=function(e,n){function t(e,n){n.local&&"local"!=e.type||n.remote&&"remote"!=e.type||(n.screen&&e.isScreen&&T.detachStreams.push(e.streamid),n.audio&&e.isAudio&&T.detachStreams.push(e.streamid),n.video&&e.isVideo&&T.detachStreams.push(e.streamid),n.audio||n.video||n.screen||T.detachStreams.push(e.streamid),-1!=T.detachStreams.indexOf(e.streamid)&&(m("removing stream",e.streamid),g(e,T),n.stop&&T.stopMediaStream(e.stream)))}if(T.numberOfConnectedUsers<=0)return void setTimeout(function(){T.removeStream(e,n)},1e3);if(e||(e="all"),!s(e)||-1!=e.search(/all|audio|video|screen/gi)){for(var i in T.streams)if(-1==T._skip.indexOf(i))if(_stream=T.streams[i],"all"==e)t(_stream,{audio:!0,video:!0,screen:!0});else if(s(e)){var o={};o[e]=!0,t(_stream,o)}else t(_stream,e);return void(!n&&T.detachStreams.length&&T.renegotiate())}var i=T.streams[e];return i?(T.detachStreams.push(i.streamid),m("removing stream",i.streamid),g(i,T),void(n||T.renegotiate())):f("No such stream exists. Stream-id:",e)},T.switchStream=function(e){return T.numberOfConnectedUsers>0?(T.removeStream("all",!0),void T.addStream(e)):void setTimeout(function(){T.switchStream(e)},1e3)},T.sendCustomMessage=function(e){return w&&w.defaultSocket?void w.defaultSocket.send({customMessage:!0,message:e}):setTimeout(function(){T.sendCustomMessage(e)},1e3)},L(T)};var N=[],F=!!window.opera||navigator.userAgent.indexOf(" OPR/")>=0,V=void 0!==window.InstallTrigger,_=Object.prototype.toString.call(window.HTMLElement).indexOf("Constructor")>0,B=!!window.chrome&&!F,j=!!document.documentMode,W=_||j,H=!!navigator.userAgent.match(/Android|iPhone|iPad|iPod|BlackBerry|IEMobile/i),q=!!(window.process&&"object"==typeof window.process&&window.process.versions&&window.process.versions["node-webkit"]);window.MediaStream=window.MediaStream||window.webkitMediaStream,window.AudioContext=window.AudioContext||window.webkitAudioContext;var z=50,G=navigator.userAgent.match(/Chrom(e|ium)\/([0-9]+)\./);B&&G&&G[2]&&(z=parseInt(G[2],10));var J=50;G=navigator.userAgent.match(/Firefox\/(.*)/),V&&G&&G[1]&&(J=parseInt(G[1],10));var Y={log:function(){},error:function(){},warn:function(){}};if(B||V||_)var m=Y.log.bind(Y),l=Y.error.bind(Y),f=Y.warn.bind(Y);var Q,X,K,$={},Z={},en='Make sure that you are using Firefox Nightly and you enabled: media.getusermedia.screensharing.enabled flag from about:config page. You also need to add your domain in "media.getusermedia.screensharing.allowed_domains" flag. If you are using WinXP then also enable "media.getusermedia.screensharing.allow_on_old_platforms" flag. NEVER forget to use "only" HTTPs for screen capturing!',nn="HTTPs i.e. SSL-based URI is mandatory to use screen capturing.",tn="ajhifddimkapgcifgcodmmfdlknahffk",on=-1!=document.domain.indexOf("webrtc-experiment.com");attachEventListener=function(e,n,t,i){e.addEventListener(n,t,i)};var sn=window.PluginRTC||{};window.onPluginRTCInitialized=function(e){sn=e,MediaStreamTrack=sn.MediaStreamTrack,an=sn.RTCPeerConnection,mn=sn.RTCIceCandidate,un=sn.RTCSessionDescription,m(W?"Java-Applet":"ActiveX","plugin has been loaded.")},r(sn)||window.onPluginRTCInitialized(sn),W&&y("https://cdn.webrtc-experiment.com/Plugin.EveryWhere.js");var rn=window.MediaStream;void 0===rn&&"undefined"!=typeof webkitMediaStream&&(rn=webkitMediaStream),void 0===rn||"stop"in rn.prototype||(rn.prototype.stop=function(){this.getAudioTracks().forEach(function(e){e.stop()}),this.getVideoTracks().forEach(function(e){e.stop()})});var an,dn={mandatory:{},optional:[]},cn={streams:[],mutex:!1,queueRequests:[]},un=window.RTCSessionDescription||window.mozRTCSessionDescription,mn=window.RTCIceCandidate||window.mozRTCIceCandidate;"undefined"!=typeof mozRTCPeerConnection?an=mozRTCPeerConnection:"undefined"!=typeof webkitRTCPeerConnection?an=webkitRTCPeerConnection:void 0!==window.RTCPeerConnection?an=window.RTCPeerConnection:Y.error("WebRTC 1.0 (RTCPeerConnection) API seems NOT available in this browser.");var ln={SaveToDisk:P},fn={send:function(e){function n(e,t){var s={type:"text",uuid:m,sendingTime:l};e&&(t=e,s.packets=parseInt(t.length/d)),t.length>d?s.message=t.slice(0,d):(s.message=t,s.last=!0,s.isobject=u),o.send(s,r),c=t.slice(s.message.length),c.length&&setTimeout(function(){n(null,c)},i.chunkInterval||100)}var i=e.connection;if(e.text instanceof ArrayBuffer||e.text instanceof DataView)return e.channel.send(e.text,e._channel);var o=e.channel,r=e._channel,a=e.text,d=i.chunkSize||1e3,c="",u=!1;s(a)||(u=!0,a=JSON.stringify(a));var m=t(),l=(new Date).getTime();n(a)}};!function(){"use strict";function e(){var e,n,t,i=(o.appVersion,o.userAgent),s=o.appName,a=""+parseFloat(o.appVersion),d=parseInt(o.appVersion,10);return-1!==(n=i.indexOf("Opera"))?(s="Opera",a=i.substring(n+6),-1!==(n=i.indexOf("Version"))&&(a=i.substring(n+8))):-1!==(n=i.indexOf("MSIE"))?(s="IE",a=i.substring(n+5)):-1!==(n=i.indexOf("Chrome"))?(s="Chrome",a=i.substring(n+7)):-1!==(n=i.indexOf("Safari"))?(s="Safari",a=i.substring(n+7),-1!==(n=i.indexOf("Version"))&&(a=i.substring(n+8))):-1!==(n=i.indexOf("Firefox"))?(s="Firefox",a=i.substring(n+8)):(e=i.lastIndexOf(" ")+1)<(n=i.lastIndexOf("/"))&&(s=i.substring(e,n),a=i.substring(n+1),s.toLowerCase()===s.toUpperCase()&&(s=o.appName)),r&&(s="Edge",a=parseInt(o.userAgent.match(/Edge\/(\d+).(\d+)$/)[2],10)),-1!==(t=a.indexOf(";"))&&(a=a.substring(0,t)),-1!==(t=a.indexOf(" "))&&(a=a.substring(0,t)),d=parseInt(""+a,10),isNaN(d)&&(a=""+parseFloat(o.appVersion),d=parseInt(o.appVersion,10)),{fullVersion:a,version:d,name:s}}function n(e){t(function(n){e(n.match(/^(192\.168\.|169\.254\.|10\.|172\.(1[6-9]|2\d|3[01]))/)?"Local: "+n:"Public: "+n)})}function t(e){function n(n){var i=/([0-9]{1,3}(\.[0-9]{1,3}){3})/,o=i.exec(n)[1];void 0===t[o]&&e(o),t[o]=!0}var t={},i=window.RTCPeerConnection||window.mozRTCPeerConnection||window.webkitRTCPeerConnection,o=!!window.webkitRTCPeerConnection;if(!i){var s=document.getElementById("iframe");if(!s)throw"NOTE: you need to have an iframe in the page right above the script tag.";var r=s.contentWindow;i=r.RTCPeerConnection||r.mozRTCPeerConnection||r.webkitRTCPeerConnection,o=!!r.webkitRTCPeerConnection}var a,d={optional:[{RtpDataChannels:!0}]};o&&(a={iceServers:[{urls:"stun:stun.services.mozilla.com"}]},void 0!==v&&v.browser.isFirefox&&v.browser.version<=38&&(a[0]={url:a[0].urls}));var c=new i(a,d);c.onicecandidate=function(e){e.candidate&&n(e.candidate.candidate)},c.createDataChannel(""),c.createOffer(function(e){c.setLocalDescription(e,function(){},function(){})},function(){}),setTimeout(function(){var e=c.localDescription.sdp.split("\n");e.forEach(function(e){0===e.indexOf("a=candidate:")&&n(e)})},1e3)}function i(e){return!o.enumerateDevices&&window.MediaStreamTrack&&window.MediaStreamTrack.getSources&&(o.enumerateDevices=window.MediaStreamTrack.getSources.bind(window.MediaStreamTrack)),!o.enumerateDevices&&o.enumerateDevices&&(o.enumerateDevices=o.enumerateDevices.bind(o)),o.enumerateDevices?(m=[],void o.enumerateDevices(function(n){n.forEach(function(e){var n={};for(var t in e)n[t]=e[t];var i;m.forEach(function(e){e.id===n.id&&(i=!0)}),i||("audio"===n.kind&&(n.kind="audioinput"),"video"===n.kind&&(n.kind="videoinput"),n.deviceId||(n.deviceId=n.id),n.id||(n.id=n.deviceId),n.label||(n.label="Please invoke getUserMedia once.",g||(n.label="HTTPs is required to get label of this "+n.kind+" device.")),("audioinput"===n.kind||"audio"===n.kind)&&(f=!0),"audiooutput"===n.kind&&(p=!0),("videoinput"===n.kind||"video"===n.kind)&&(h=!0),m.push(n))}),void 0!==v&&(v.MediaDevices=m,v.hasMicrophone=f,v.hasSpeakers=p,v.hasWebcam=h),e&&e()})):void(e&&e())}var o=window.navigator;o.mediaDevices&&o.mediaDevices.enumerateDevices&&(o.enumerateDevices=function(e){o.mediaDevices.enumerateDevices().then(e)}),void 0!==o?(void 0!==o.webkitGetUserMedia&&(o.getUserMedia=o.webkitGetUserMedia),void 0!==o.mozGetUserMedia&&(o.getUserMedia=o.mozGetUserMedia)):o={getUserMedia:function(){}};var s=!!o.userAgent.match(/Android|iPhone|iPad|iPod|BlackBerry|IEMobile/i),r=!(-1===o.userAgent.indexOf("Edge")||!o.msSaveOrOpenBlob&&!o.msSaveBlob),a={Android:function(){return o.userAgent.match(/Android/i)},BlackBerry:function(){return o.userAgent.match(/BlackBerry/i)},iOS:function(){return o.userAgent.match(/iPhone|iPad|iPod/i)},Opera:function(){return o.userAgent.match(/Opera Mini/i)},Windows:function(){return o.userAgent.match(/IEMobile/i)},any:function(){return a.Android()||a.BlackBerry()||a.iOS()||a.Opera()||a.Windows()},getOsName:function(){var e="Unknown OS";return a.Android()&&(e="Android"),a.BlackBerry()&&(e="BlackBerry"),a.iOS()&&(e="iOS"),a.Opera()&&(e="Opera Mini"),a.Windows()&&(e="Windows"),e}},d="Unknown OS";a.any()?d=a.getOsName():(-1!==o.appVersion.indexOf("Win")&&(d="Windows"),-1!==o.appVersion.indexOf("Mac")&&(d="MacOS"),-1!==o.appVersion.indexOf("X11")&&(d="UNIX"),-1!==o.appVersion.indexOf("Linux")&&(d="Linux"));var c=!1,u=!1;["captureStream","mozCaptureStream","webkitCaptureStream"].forEach(function(e){e in document.createElement("canvas")&&(c=!0),e in document.createElement("video")&&(u=!0)});var m=[],l=!1;"undefined"!=typeof MediaStreamTrack&&"getSources"in MediaStreamTrack?l=!0:o.mediaDevices&&o.mediaDevices.enumerateDevices&&(l=!0);var f=l,p=l,h=l;i();var v={};v.browser=e(),v.browser["is"+v.browser.name]=!0;var g="https:"===location.protocol,S=(!!(window.process&&"object"==typeof window.process&&window.process.versions&&window.process.versions["node-webkit"]),!1);["webkitRTCPeerConnection","mozRTCPeerConnection","RTCIceGatherer"].forEach(function(e){e in window&&(S=!0)}),v.isWebRTCSupported=S,v.isORTCSupported="undefined"!=typeof RTCIceGatherer;var w=!1;v.browser.isChrome&&v.browser.version>=35?w=!0:v.browser.isFirefox&&v.browser.version>=34&&(w=!0),g||(w=!1),v.isScreenCapturingSupported=w;var C={};["AudioContext","webkitAudioContext","mozAudioContext","msAudioContext"].forEach(function(e){C.isSupported&&C.isCreateMediaStreamSourceSupported||e in window&&(C.isSupported=!0,"createMediaStreamSource"in window[e].prototype&&(C.isCreateMediaStreamSourceSupported=!0))}),v.isAudioContextSupported=C.isSupported,v.isCreateMediaStreamSourceSupported=C.isCreateMediaStreamSourceSupported;var b=!1;v.browser.isChrome&&v.browser.version>31&&(b=!0),v.isRtpDataChannelsSupported=b;var y=!1;if(v.browser.isFirefox&&v.browser.version>28?y=!0:v.browser.isChrome&&v.browser.version>25?y=!0:v.browser.isOpera&&v.browser.version>=11&&(y=!0),v.isSctpDataChannelsSupported=y,v.isMobileDevice=s,v.isWebSocketsSupported="WebSocket"in window&&2===window.WebSocket.CLOSING,v.isWebSocketsBlocked="Checking",v.isWebSocketsSupported){var T=new WebSocket("wss://echo.websocket.org:443/");T.onopen=function(){v.isWebSocketsBlocked=!1,v.loadCallback&&v.loadCallback()},T.onerror=function(){v.isWebSocketsBlocked=!0,v.loadCallback&&v.loadCallback()}}var k=!1;o.getUserMedia?k=!0:o.mediaDevices&&o.mediaDevices.getUserMedia&&(k=!0),!v.browser.isChrome||v.browser.version<47||g||(v.isGetUserMediaSupported="Requires HTTPs"),v.isGetUserMediaSupported=k,v.osName=d,v.isCanvasSupportsStreamCapturing=c,v.isVideoSupportsStreamCapturing=u,v.DetectLocalIPAddress=n,v.load=function(e){this.loadCallback=e,i(e)},v.MediaDevices=m,v.hasMicrophone=f,v.hasSpeakers=p,v.hasWebcam=h;var R=!1;"setSinkId"in document.createElement("video")&&(R=!0),v.isSetSinkIdSupported=R;var x=!1;v.browser.isFirefox?"getSenders"in mozRTCPeerConnection.prototype&&(x=!0):v.browser.isChrome&&"getSenders"in webkitRTCPeerConnection.prototype&&(x=!0),v.isRTPSenderReplaceTracksSupported=x;var M=!1;v.browser.isFirefox&&v.browser.version>38&&(M=!0),v.isRemoteStreamProcessingSupported=M;var D=!1;"undefined"!=typeof MediaStreamTrack&&"applyConstraints"in MediaStreamTrack.prototype&&(D=!0),v.isApplyConstraintsSupported=D;var O=!1;v.browser.isFirefox&&v.browser.version>=43&&(O=!0),v.isMultiMonitorScreenCapturingSupported=O,window.DetectRTC=v}();var pn;DetectRTC.screen={chromeMediaSource:"screen",extensionid:tn,getSourceId:function(e){function n(n){return"installed-enabled"==n?(pn=e,void window.postMessage("get-sourceId","*")):(DetectRTC.screen.chromeMediaSource="screen",void e("No-Response"))}if(!e)throw'"callback" parameter is mandatory.';DetectRTC.screen.status?n(DetectRTC.screen.status):DetectRTC.screen.getChromeExtensionStatus(n)},onMessageCallback:function(e){if(s(e)||e.sourceId){if(m("chrome message",e),"PermissionDeniedError"==e){if(DetectRTC.screen.chromeMediaSource="PermissionDeniedError",pn)return pn("PermissionDeniedError");throw Error("PermissionDeniedError")}"rtcmulticonnection-extension-loaded"==e&&(DetectRTC.screen.chromeMediaSource="desktop",DetectRTC.screen.onScreenCapturingExtensionAvailable&&(DetectRTC.screen.onScreenCapturingExtensionAvailable(),DetectRTC.screen.onScreenCapturingExtensionAvailable=null)),e.sourceId&&(DetectRTC.screen.sourceId=e.sourceId,pn&&pn(DetectRTC.screen.sourceId))}},getChromeExtensionStatus:function(e,n){function t(e){DetectRTC.screen.status=e,n(e)}if(V)return t("not-chrome");2!=arguments.length&&(n=e,e=this.extensionid);var i=document.createElement("img");i.src="chrome-extension://"+e+"/icon.png",i.onload=function(){DetectRTC.screen.chromeMediaSource="screen",window.postMessage("are-you-there","*"),setTimeout(function(){t("screen"==DetectRTC.screen.chromeMediaSource?"desktop"==DetectRTC.screen.chromeMediaSource?"installed-enabled":"installed-disabled":"installed-enabled")},2e3)},i.onerror=function(){t("not-installed")}}},window.addEventListener||(window.addEventListener=function(e,n,t){e.attachEvent&&e.attachEvent("on"+n,t)}),window.addEventListener("message",function(e){e.origin==window.location.origin&&DetectRTC.screen.onMessageCallback(e.data)})}();