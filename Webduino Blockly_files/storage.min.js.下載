"use strict";var BlocklyStorage={STORAGE_URL:"https://glowing-fire-4998.firebaseio.com",isLinkUrl:function(){return/^#[0-9a-zA-Z]{10,15}$/.test(window.location.hash)},backupBlocks_:function(e){if("localStorage"in window){var o=Blockly.Xml.workspaceToDom(e),t=window.location.origin;window.localStorage.setItem(t,Blockly.Xml.domToText(o))}},backupOnUnload:function(e){var o,t=e||Blockly.getMainWorkspace();window.addEventListener("beforeunload",function(e){if(BlocklyStorage.unsaved)return o=setTimeout(function(){BlocklyStorage.save(Code.workspace)},1e3),(e||window.event).returnValue="save","save"},!1),window.addEventListener("unload",function(){BlocklyStorage.isLinkUrl()||BlocklyStorage.backupBlocks_(t),BlocklyStorage.unsaved&&clearTimeout(o)},!1)},restoreBlocks:function(e){var o=window.location.origin;if("localStorage"in window&&window.localStorage[o]){var t=e||Blockly.getMainWorkspace(),l=Blockly.Xml.textToDom(window.localStorage[o]);Blockly.Xml.domToWorkspace(l,t)}},link:function(e){var o=e||Blockly.getMainWorkspace(),t=Blockly.Xml.workspaceToDom(o),l=Blockly.Xml.domToText(t);BlocklyStorage.makeRequest_("/blockly","xml",l,o)},retrieveXml:function(e,o){var t=o||Blockly.getMainWorkspace();BlocklyStorage.makeRequest_("/blockly","key",e,t)},httpRequest_:null,makeRequest_:function(e,o,t,l){switch(BlocklyStorage.httpRequest_&&BlocklyStorage.httpRequest_.abort(),BlocklyStorage.httpRequest_=new XMLHttpRequest,BlocklyStorage.httpRequest_.name=o,BlocklyStorage.httpRequest_.onreadystatechange=BlocklyStorage.handleRequest_,o){case"xml":BlocklyStorage.httpRequest_.open("POST",BlocklyStorage.STORAGE_URL+e+".json"),BlocklyStorage.httpRequest_.setRequestHeader("Content-Type","application/x-www-form-urlencoded"),BlocklyStorage.httpRequest_.send(JSON.stringify({xml:t}));break;case"key":BlocklyStorage.httpRequest_.open("GET",BlocklyStorage.STORAGE_URL+e+"/"+t+".json"),BlocklyStorage.httpRequest_.send()}BlocklyStorage.httpRequest_.workspace=l},handleRequest_:function(){if(4==BlocklyStorage.httpRequest_.readyState){if(200!=BlocklyStorage.httpRequest_.status)BlocklyStorage.alert(BlocklyStorage.HTTPREQUEST_ERROR+"\nhttpRequest_.status: "+BlocklyStorage.httpRequest_.status,"error");else{var e=BlocklyStorage.httpRequest_.responseText.trim();"xml"==BlocklyStorage.httpRequest_.name?(e=JSON.parse(e).name,window.location.hash=e,BlocklyStorage.alert(BlocklyStorage.LINK_ALERT.replace("%1",window.location.href),"error")):"key"==BlocklyStorage.httpRequest_.name&&(e.length?(e=JSON.parse(e).xml,BlocklyStorage.loadXml_(e,BlocklyStorage.httpRequest_.workspace)):BlocklyStorage.alert(BlocklyStorage.HASH_ERROR.replace("%1",window.location.hash),"error")),BlocklyStorage.monitorChanges_(BlocklyStorage.httpRequest_.workspace)}BlocklyStorage.httpRequest_=null}},monitorChanges_:function(e){var o=Blockly.Xml.workspaceToDom(e),t=Blockly.Xml.domToText(o);var l=e.addChangeListener(function(){var o=Blockly.Xml.workspaceToDom(e),a=Blockly.Xml.domToText(o);t!=a&&(history.pushState("",document.title,window.location.pathname+window.location.search),e.removeChangeListener(l))})},loadXml_:function(e,o){try{e=Blockly.Xml.textToDom(e)}catch(o){return void BlocklyStorage.alert(BlocklyStorage.XML_ERROR+"\nXML: "+e,"error")}o.clear(),Blockly.Events.disable(),Blockly.Xml.domToWorkspace(e,o),Blockly.Events.enable()},alert:function(e,o){var t={text:e,allowOutsideClick:!1};return o&&(t.icon=o),swal(t)}};