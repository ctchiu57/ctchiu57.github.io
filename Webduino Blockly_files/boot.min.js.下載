!function(o,t){"use strict";t.initHandlebars(),Promise.all([new Promise(function(o){$.ajax("/blockly/remoteUser").done(function(t){o(t)}).fail(function(t,e){console.warn("Request failed: status:"+e+", statusText:"+t.statusText),o()})}),t.loadDoc("./views/"+t.PAGE.split("/")[0]+".handlebars").then(function(o){t.renderPage(o.body.innerHTML)}).then(function(){return new Promise(function(o){document.getElementById("simulator-frame").contentWindow.addEventListener("load",function(){o()},!1)})}),t.loadDoc("./toolbox/"+t.PAGE+".xml").then(function(o){t.rawToolbox=t.trimXml(o.body.firstChild)}).then(function(){return new Promise(function(e){if("BlocklyStorage"in o&&BlocklyStorage.isLinkUrl()){var n=location.hash.replace("#","");axios.get("/api/projects/linkData?hashid="+n).then(function(n){var i=n.data;return i&&i.errCode&&401===i.errCode?(swal({icon:"warning",title:MSG.loadProjectFailed,text:MSG.loginToReadLink,buttons:[MSG.cancel,MSG.loginPlatform]}).then(function(t){t&&o.open("https://id.webduino.io")}),e()):i&&i.errCode&&423===i.errCode?(swal({icon:"warning",title:MSG.linkExpired}),e()):(t.loadedData=i||null,void e(t.loadedData))}).catch(function(o){console.error("load project failed!",o.message),e()})}else e()})}).then(function(o){return o&&o.customBlocks}).then(function(o){var e=[],n=JSON.parse(localStorage.getItem("customBlocks"));return n&&(e=e.concat(n)),o&&(e=e.concat(o)),e=e.filter(function(o,t,e){return e.indexOf(o)===t}),e=t.parseCustomBlocks(e),t.LOADER_CONFIG=t.LOADER_CONFIG.concat(e),t.LOADER_CONFIG=t.LOADER_CONFIG.filter(function(o,t,e){return e.indexOf(o)===t}),Promise.all(t.LOADER_CONFIG.map(function(o){return t.loadBlockDefs(o)})).then(function(o){return localStorage.setItem("customBlocks",JSON.stringify(e)),o})}).then(function(o){o.forEach(function(o){t.addToolbox(o.category,o.toolboxXml)})}).catch(function(o){console.log("load custom blocks throw the error"),console.error(o)}),new Promise(function(t){o.addEventListener("load",function(){t()},!1)})]).then(function(e){t.notify.init(),t.setUser(e[0]),t.updateTitle(e[0]),t.customTab.init(),t.init(t.getToolBox()),t.loadDemoArea(),t.loadSimulator(),t.loadGa(e[0]),t.ga(),t.importPrettify(),t.bindHotkey(o.document),t.checkDeviceOnline(),t.loadJs("dist/webduino-samples.min.js",function(){t.loadSample()}),t.loadJs("dist/lib/clipboard.min.js",function(){t.copyCode()}),t.loadJs("dist/lib/babel.min.js"),t.loadJs("dist/lib/saveSvgAsPng.min.js"),t.loadJs("dist/demoArea-resize.min.js"),t.loadJs("dist/demoArea-dnd.min.js"),t.loadJs("dist/simulator-resize.min.js"),t.loadJs("dist/simulator-dnd.min.js"),t.loadedData&&t.loadedData.simulator&&t.simulator.update(t.loadedData.simulator),chromeVersion.isValid()||swal({text:MSG.updateChrome,icon:"info"})}).catch(function(o){console.error(o),401!==o.status&&404!==o.status||BlocklyStorage.alert("專案不存在或此專案尚未公開分享!","error").then(function(o){location.href="/"})})}(window,window.Code);